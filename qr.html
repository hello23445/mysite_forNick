<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <title>Генератор QR кодов</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" async></script>
  <style>
    :root {
      --primary-color: #5563DE;
      --primary-hover: #4452c9;
      --background-light: rgba(255, 255, 255, 0.95);
      --text-light: #333;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
      overflow-y: auto;
    }

    body {
      background: linear-gradient(135deg, #74ABE2, #5563DE);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 10px;
      min-height: 100vh;
      box-sizing: border-box;
    }

    #statusMessage {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1100;
      background: #fff;
      padding: 8px 16px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      font-size: 14px;
    }

    .container {
      background: var(--background-light);
      border-radius: 10px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 1000px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      max-height: calc(100vh - 20px);
      overflow-y: auto;
      box-sizing: border-box;
    }

    @media (min-width: 768px) {
      .container {
        flex-direction: row;
      }
      .qr-container {
        border-left: 1px solid #ccc;
        padding-left: 15px;
      }
      .form-container {
        padding: 15px;
      }
    }

    @media (max-width: 767px) {
      .container {
        padding: 10px;
      }
      .qr-container, .form-container {
        padding: 10px;
      }
      .qr-settings {
        max-width: 100%;
      }
      #backToMain {
        position: static;
        margin: 0 auto 10px;
        display: block;
      }
    }

    @media (min-width: 768px) {
      #backToMain {
        position: absolute;
        bottom: 10px;
        left: 10px;
      }
    }

    .qr-container {
      flex: 1;
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      gap: 15px;
      overflow-y: auto;
      max-height: calc(100vh - 40px);
    }

    .qr-settings {
      flex: 1;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.9);
      text-align: left;
      max-width: 100%;
      box-sizing: border-box;
    }

    .qr-preview-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .qr-preview {
      flex: 0 0 auto;
      transition: transform 0.3s ease;
      padding: 8px;
      background: #fff;
      border-radius: 8px;
      text-align: center;
      position: relative;
    }

    .form-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      max-height: calc(100vh - 40px);
    }

    select#qrType {
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
    }

    .input-group {
      margin: 8px 0;
      width: 100%;
    }

    .input-group-flex {
      display: flex;
      align-items: center;
      gap: 5px;
      width: 100%;
    }

    .input-group-flex input,
    .input-group-flex select,
    .input-group-flex textarea {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    .generate, .backButton {
      margin-top: 10px;
      padding: 10px 20px;
      width: auto;
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-size: 14px;
      align-self: center;
    }

    .generate:hover, .backButton:hover {
      background-color: var(--primary-hover);
    }

    .info-button {
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 5px;
    }

    .info-button:hover {
      background-color: var(--primary-hover);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 15px;
      border: 1px solid #888;
      width: 90%;
      max-width: 350px;
      border-radius: 8px;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: #000;
    }

    #warningMessage h3 {
      color: red;
      font-weight: bold;
      text-align: center;
      display: inline-block;
      font-size: 14px;
    }

    #warningInfoBtn {
      margin-left: 8px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 3px;
    }

    #warningInfoBtn:hover {
      background-color: var(--primary-hover);
    }

    .qr-settings label {
      display: block;
      margin-bottom: 15px;
      font-weight: bold;
      font-size: 14px;
    }

    .qr-settings input[type="range"] {
      width: 100%;
      margin-bottom: 15px;
    }

    .color-palette {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-start;
      margin-bottom: 15px;
      max-height: 150px;
      overflow-y: auto;
    }

    .color-option {
      width: 25px;
      height: 25px;
      border-radius: 5px;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .color-option.selected {
      border: 2px solid #000;
    }

    #backToMain {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="statusMessage"></div>
  
  <div class="container">
    <div class="form-container">
      <button id="backToMain" onclick="window.location.href = 'main.html'">ВЕРНУТЬСЯ В ГЛАВНОЕ МЕНЮ</button>
      <select id="qrType" onchange="updateForm()">
        <option value="url">Ссылка</option>
        <option value="wifi">Сеть WiFi</option>
        <option value="contact">Контакт</option>
        <option value="text">Текстовое сообщение</option>
        <option value="map">Карта</option>
        <option value="whatsapp">WhatsApp</option>
        <option value="phone">Телефонный звонок</option>
        <option value="email">Email</option>
        <option value="sms">SMS</option>
        <option value="payment">Платеж</option>
        <option value="skype">Skype</option>
        <option value="telegram">Telegram</option>
        <option value="facebook">Facebook</option>
        <option value="instagram">Instagram</option>
        <option value="linkedin">LinkedIn</option>
        <option value="youtube">YouTube</option>
        <option value="viber">Viber</option>
        <option value="pinterest">Pinterest</option>
        <option value="x">X</option>
        <option value="tiktok">TikTok</option>
        <option value="discord">Discord</option>
        <option value="snapchat">Snapchat</option>
        <option value="reddit">Reddit</option>
        <option value="twitch">Twitch</option>
        <option value="signal">Signal</option>
        <option value="wechat">WeChat</option>
        <option value="line">Line</option>
      </select>
      
      <div id="urlForm" class="input-group">
        <div class="input-group-flex">
          <input type="text" id="urlInput" placeholder="Введите ссылку или @username">
          <button type="button" class="info-button" onclick="showFieldInfo('url')">?</button>
        </div>
      </div>
      
      <div id="wifiForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="wifiSSID" placeholder="SSID сети (Название сети)">
          <button type="button" class="info-button" onclick="showFieldInfo('wifiSSID')">?</button>
        </div>
        <div class="input-group-flex">
          <select id="wifiEncryption" onchange="toggleWifiPassword()">
            <option value="WPA">WPA/WPA2</option>
            <option value="WEP">WEP</option>
            <option value="nopass">Нет пароля</option>
          </select>
          <button type="button" class="info-button" onclick="showFieldInfo('wifiEncryption')">?</button>
        </div>
        <div class="input-group-flex">
          <input type="text" id="wifiPassword" placeholder="Пароль">
          <button type="button" class="info-button" onclick="showFieldInfo('wifiPassword')">?</button>
        </div>
      </div>
      
      <div id="contactForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="contactName" placeholder="Имя (только латиница)" pattern="[a-zA-Z\s]+">
          <button type="button" class="info-button" onclick="showFieldInfo('contactName')">?</button>
        </div>
        <div class="input-group-flex">
          <input type="tel" id="contactPhone" placeholder="Телефон" class="phone-format">
          <button type="button" class="info-button" onclick="showFieldInfo('contactPhone')">?</button>
        </div>
        <div class="input-group-flex">
          <input type="email" id="contactEmail" placeholder="Email">
          <button type="button" class="info-button" onclick="showFieldInfo('contactEmail')">?</button>
        </div>
      </div>
      
      <div id="textForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <textarea id="textMessage" placeholder="Введите текст сообщения"></textarea>
          <button type="button" class="info-button" onclick="showFieldInfo('textMessage')">?</button>
        </div>
      </div>
      
      <div id="mapForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="mapInput" placeholder="Введите адрес или координаты">
          <button type="button" class="info-button" onclick="showFieldInfo('mapInput')">?</button>
        </div>
      </div>
      
      <div id="whatsappForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="tel" id="whatsappPhone" placeholder="Введите номер телефона (с кодом страны)" class="phone-format">
          <button type="button" class="info-button" onclick="showFieldInfo('whatsappPhone')">?</button>
        </div>
        <div class="input-group-flex">
          <input type="text" id="whatsappMessage" placeholder="Введите сообщение (необязательно)">
          <button type="button" class="info-button" onclick="showFieldInfo('whatsappMessage')">?</button>
        </div>
      </div>
      
      <div id="phoneForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="tel" id="phoneNumber" placeholder="Введите номер телефона" class="phone-format">
          <button type="button" class="info-button" onclick="showFieldInfo('phoneNumber')">?</button>
        </div>
      </div>
      
      <div id="emailForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="email" id="emailAddress" placeholder="Введите Email адрес">
          <button type="button" class="info-button" onclick="showFieldInfo('emailAddress')">?</button>
        </div>
        <div class="input-group-flex">
          <input type="text" id="emailSubject" placeholder="Введите тему (необязательно)">
          <button type="button" class="info-button" onclick="showFieldInfo('emailSubject')">?</button>
        </div>
        <div class="input-group-flex">
          <textarea id="emailBody" placeholder="Введите сообщение (необязательно)"></textarea>
          <button type="button" class="info-button" onclick="showFieldInfo('emailBody')">?</button>
        </div>
      </div>
      
      <div id="smsForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="tel" id="smsPhone" placeholder="Введите номер телефона" class="phone-format">
          <button type="button" class="info-button" onclick="showFieldInfo('smsPhone')">?</button>
        </div>
        <div class="input-group-flex">
          <textarea id="smsMessage" placeholder="Введите сообщение (необязательно)"></textarea>
          <button type="button" class="info-button" onclick="showFieldInfo('smsMessage')">?</button>
        </div>
      </div>
      
      <div id="paymentForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="paymentAccount" placeholder="Введите номер счета/идентификатор">
          <button type="button" class="info-button" onclick="showFieldInfo('paymentAccount')">?</button>
        </div>
        <div class="input-group-flex">
          <input type="number" id="paymentAmount" placeholder="Введите сумму платежа" min="0" step="0.01">
          <button type="button" class="info-button" onclick="showFieldInfo('paymentAmount')">?</button>
        </div>
        <div class="input-group-flex">
          <textarea id="paymentDesc" placeholder="Введите назначение платежа (необязательно)"></textarea>
          <button type="button" class="info-button" onclick="showFieldInfo('paymentDesc')">?</button>
        </div>
      </div>
      
      <div id="skypeForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="skypeUsername" placeholder="Введите Skype логин">
          <button type="button" class="info-button" onclick="showFieldInfo('skypeUsername')">?</button>
        </div>
      </div>
      
      <div id="telegramForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="telegramUsername" placeholder="Введите Telegram логин">
          <button type="button" class="info-button" onclick="showFieldInfo('telegramUsername')">?</button>
        </div>
      </div>
      
      <div id="facebookForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="facebookUsername" placeholder="Введите Facebook логин/ID">
          <button type="button" class="info-button" onclick="showFieldInfo('facebookUsername')">?</button>
        </div>
      </div>
      
      <div id="instagramForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="instagramUsername" placeholder="Введите Instagram логин">
          <button type="button" class="info-button" onclick="showFieldInfo('instagramUsername')">?</button>
        </div>
      </div>
      
      <div id="linkedinForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="linkedinUsername" placeholder="Введите LinkedIn логин">
          <button type="button" class="info-button" onclick="showFieldInfo('linkedinUsername')">?</button>
        </div>
      </div>
      
      <div id="youtubeForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="youtubeChannel" placeholder="Введите YouTube ID или ссылку">
          <button type="button" class="info-button" onclick="showFieldInfo('youtubeChannel')">?</button>
        </div>
      </div>
      
      <div id="viberForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="tel" id="viberNumber" placeholder="Введите номер для Viber" class="phone-format">
          <button type="button" class="info-button" onclick="showFieldInfo('viberNumber')">?</button>
        </div>
      </div>
      
      <div id="pinterestForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="pinterestUsername" placeholder="Введите Pinterest логин">
          <button type="button" class="info-button" onclick="showFieldInfo('pinterestUsername')">?</button>
        </div>
      </div>
      
      <div id="xForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="xUsername" placeholder="Введите X логин">
          <button type="button" class="info-button" onclick="showFieldInfo('xUsername')">?</button>
        </div>
      </div>
      
      <div id="tiktokForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="tiktokUsername" placeholder="Введите TikTok логин">
          <button type="button" class="info-button" onclick="showFieldInfo('tiktokUsername')">?</button>
        </div>
      </div>
      
      <div id="discordForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="discordUsername" placeholder="Введите Discord логин или ID">
          <button type="button" class="info-button" onclick="showFieldInfo('discordUsername')">?</button>
        </div>
      </div>
      
      <div id="snapchatForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="snapchatUsername" placeholder="Введите Snapchat логин">
          <button type="button" class="info-button" onclick="showFieldInfo('snapchatUsername')">?</button>
        </div>
      </div>
      
      <div id="redditForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="redditUsername" placeholder="Введите Reddit логин">
          <button type="button" class="info-button" onclick="showFieldInfo('redditUsername')">?</button>
        </div>
      </div>
      
      <div id="twitchForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="twitchUsername" placeholder="Введите Twitch логин">
          <button type="button" class="info-button" onclick="showFieldInfo('twitchUsername')">?</button>
        </div>
      </div>
      
      <div id="signalForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="tel" id="signalNumber" placeholder="Введите номер для Signal" class="phone-format">
          <button type="button" class="info-button" onclick="showFieldInfo('signalNumber')">?</button>
        </div>
      </div>
      
      <div id="wechatForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="wechatUsername" placeholder="Введите WeChat ID">
          <button type="button" class="info-button" onclick="showFieldInfo('wechatUsername')">?</button>
        </div>
      </div>
      
      <div id="lineForm" class="input-group" style="display: none;">
        <div class="input-group-flex">
          <input type="text" id="lineUsername" placeholder="Введите Line ID">
          <button type="button" class="info-button" onclick="showFieldInfo('lineUsername')">?</button>
        </div>
      </div>
      
      <button type="button" class="generate" onclick="generateQRCode()">Сгенерировать</button>
    </div>
    <div class="qr-container" id="qrContainer">
      <div class="qr-settings" id="qrSettings">
        <label for="qrSize">Размер QR-кода:</label>
        <input type="range" id="qrSize" min="100" max="300" value="200">
        <label>Цвет QR-кода:</label>
        <div class="color-palette" id="colorPalette">
          <div class="color-option" style="background-color: #666666" data-color="#666666"></div>
          <div class="color-option" style="background-color: #000000" data-color="#000000"></div>
          <div class="color-option" style="background-color: #333333" data-color="#333333"></div>
          <div class="color-option" style="background-color: #ff3333" data-color="#ff3333"></div>
          <div class="color-option" style="background-color: #ff0000" data-color="#ff0000"></div>
          <div class="color-option" style="background-color: #cc0000" data-color="#cc0000"></div>
          <div class="color-option" style="background-color: #33ff33" data-color="#33ff33"></div>
          <div class="color-option" style="background-color: #00ff00" data-color="#00ff00"></div>
          <div class="color-option" style="background-color: #00cc00" data-color="#00cc00"></div>
          <div class="color-option" style="background-color: #3333ff" data-color="#3333ff"></div>
          <div class="color-option" style="background-color: #0000ff" data-color="#0000ff"></div>
          <div class="color-option" style="background-color: #0000cc" data-color="#0000cc"></div>
          <div class="color-option" style="background-color: #ffbb33" data-color="#ffbb33"></div>
          <div class="color-option" style="background-color: #ffa500" data-color="#ffa500"></div>
          <div class="color-option" style="background-color: #cc8400" data-color="#cc8400"></div>
          <div class="color-option" style="background-color: #9933cc" data-color="#9933cc"></div>
          <div class="color-option" style="background-color: #800080" data-color="#800080"></div>
          <div class="color-option" style="background-color: #660066" data-color="#660066"></div>
          <div class="color-option" style="background-color: #33cc33" data-color="#33cc33"></div>
          <div class="color-option" style="background-color: #008000" data-color="#008000"></div>
          <div class="color-option" style="background-color: #006600" data-color="#006600"></div>
          <div class="color-option" style="background-color: #ff6b33" data-color="#ff6b33"></div>
          <div class="color-option" style="background-color: #ff4500" data-color="#ff4500"></div>
          <div class="color-option" style="background-color: #cc3600" data-color="#cc3600"></div>
          <div class="color-option" style="background-color: #54a57a" data-color="#54a57a"></div>
          <div class="color-option" style="background-color: #2e8b57" data-color="#2e8b57"></div>
          <div class="color-option" style="background-color: #256b45" data-color="#256b45"></div>
          <div class="color-option" style="background-color: #6699cc" data-color="#6699cc"></div>
          <div class="color-option" style="background-color: #4682b4" data-color="#4682b4"></div>
          <div class="color-option" style="background-color: #386890" data-color="#386890"></div>
          <div class="color-option" style="background-color: #db8744" data-color="#db8744"></div>
          <div class="color-option" style="background-color: #d2691e" data-color="#d2691e"></div>
          <div class="color-option" style="background-color: #a95418" data-color="#a95418"></div>
          <div class="color-option" style="background-color: #b17cc9" data-color="#b17cc9"></div>
          <div class="color-option" style="background-color: #9b59b6" data-color="#9b59b6"></div>
          <div class="color-option" style="background-color: #7c4792" data-color="#7c4792"></div>
          <div class="color-option" style="background-color: #5caee3" data-color="#5caee3"></div>
          <div class="color-option" style="background-color: #3498db" data-color="#3498db"></div>
          <div class="color-option" style="background-color: #2a7aaf" data-color="#2a7aaf"></div>
          <div class="color-option" style="background-color: #ed7669" data-color="#ed7669"></div>
          <div class="color-option" style="background-color: #e74c3c" data-color="#e74c3c"></div>
          <div class="color-option" style="background-color: #b93d30" data-color="#b93d30"></div>
          <div class="color-option" style="background-color: #4fc381" data-color="#4fc381"></div>
          <div class="color-option" style="background-color: #27ae60" data-color="#27ae60"></div>
          <div class="color-option" style="background-color: #1f8b4c" data-color="#1f8b4c"></div>
          <div class="color-option" style="background-color: #f4d33f" data-color="#f4d33f"></div>
          <div class="color-option" style="background-color: #f1c40f" data-color="#f1c40f"></div>
          <div class="color-option" style="background-color: #c19e0c" data-color="#c19e0c"></div>
          <div class="color-option" style="background-color: #a865c3" data-color="#a865c3"></div>
          <div class="color-option" style="background-color: #8e44ad" data-color="#8e44ad"></div>
          <div class="color-option" style="background-color: #72368a" data-color="#72368a"></div>
          <div class="color-option" style="background-color: #3bbca0" data-color="#3bbca0"></div>
          <div class="color-option" style="background-color: #16a085" data-color="#16a085"></div>
          <div class="color-option" style="background-color: #11806a" data-color="#11806a"></div>
          <div class="color-option" style="background-color: #ffffff" data-color="#ffffff"></div>
          <div class="color-option" style="background-color: #f5f5f5" data-color="#f5f5f5"></div>
          <div class="color-option" style="background-color: #e0e0e0" data-color="#e0e0e0"></div>
          <div class="color-option" style="background-color: #ff69b4" data-color="#ff69b4"></div>
          <div class="color-option" style="background-color: #ff1493" data-color="#ff1493"></div>
          <div class="color-option" style="background-color: #c71585" data-color="#c71585"></div>
          <div class="color-option" style="background-color: #00ffff" data-color="#00ffff"></div>
          <div class="color-option" style="background-color: #00ced1" data-color="#00ced1"></div>
          <div class="color-option" style="background-color: #008b8b" data-color="#008b8b"></div>
          <div class="color-option" style="background-color: #ffd700" data-color="#ffd700"></div>
          <div class="color-option" style="background-color: #daa520" data-color="#daa520"></div>
          <div class="color-option" style="background-color: #b8860b" data-color="#b8860b"></div>
          <div class="color-option" style="background-color: #ff6347" data-color="#ff6347"></div>
          <div class="color-option" style="background-color: #dc143c" data-color="#dc143c"></div>
          <div class="color-option" style="background-color: #a52a2a" data-color="#a52a2a"></div>
          <div class="color-option" style="background-color: #6a5acd" data-color="#6a5acd"></div>
          <div class="color-option" style="background-color: #483d8b" data-color="#483d8b"></div>
          <div class="color-option" style="background-color: #2f4f4f" data-color="#2f4f4f"></div>
          <div class="color-option" style="background-color: #9acd32" data-color="#9acd32"></div>
        </div>
        <label>Цвет фона QR-кода:</label>
        <div class="color-palette" id="backgroundColorPalette">
          <div class="color-option" style="background-color: #666666" data-color="#666666"></div>
          <div class="color-option" style="background-color: #000000" data-color="#000000"></div>
          <div class="color-option" style="background-color: #333333" data-color="#333333"></div>
          <div class="color-option" style="background-color: #ff3333" data-color="#ff3333"></div>
          <div class="color-option" style="background-color: #ff0000" data-color="#ff0000"></div>
          <div class="color-option" style="background-color: #cc0000" data-color="#cc0000"></div>
          <div class="color-option" style="background-color: #33ff33" data-color="#33ff33"></div>
          <div class="color-option" style="background-color: #00ff00" data-color="#00ff00"></div>
          <div class="color-option" style="background-color: #00cc00" data-color="#00cc00"></div>
          <div class="color-option" style="background-color: #3333ff" data-color="#3333ff"></div>
          <div class="color-option" style="background-color: #0000ff" data-color="#0000ff"></div>
          <div class="color-option" style="background-color: #0000cc" data-color="#0000cc"></div>
          <div class="color-option" style="background-color: #ffbb33" data-color="#ffbb33"></div>
          <div class="color-option" style="background-color: #ffa500" data-color="#ffa500"></div>
          <div class="color-option" style="background-color: #cc8400" data-color="#cc8400"></div>
          <div class="color-option" style="background-color: #9933cc" data-color="#9933cc"></div>
          <div class="color-option" style="background-color: #800080" data-color="#800080"></div>
          <div class="color-option" style="background-color: #660066" data-color="#660066"></div>
          <div class="color-option" style="background-color: #33cc33" data-color="#33cc33"></div>
          <div class="color-option" style="background-color: #008000" data-color="#008000"></div>
          <div class="color-option" style="background-color: #006600" data-color="#006600"></div>
          <div class="color-option" style="background-color: #ff6b33" data-color="#ff6b33"></div>
          <div class="color-option" style="background-color: #ff4500" data-color="#ff4500"></div>
          <div class="color-option" style="background-color: #cc3600" data-color="#cc3600"></div>
          <div class="color-option" style="background-color: #54a57a" data-color="#54a57a"></div>
          <div class="color-option" style="background-color: #2e8b57" data-color="#2e8b57"></div>
          <div class="color-option" style="background-color: #256b45" data-color="#256b45"></div>
          <div class="color-option" style="background-color: #6699cc" data-color="#6699cc"></div>
          <div class="color-option" style="background-color: #4682b4" data-color="#4682b4"></div>
          <div class="color-option" style="background-color: #386890" data-color="#386890"></div>
          <div class="color-option" style="background-color: #db8744" data-color="#db8744"></div>
          <div class="color-option" style="background-color: #d2691e" data-color="#d2691e"></div>
          <div class="color-option" style="background-color: #a95418" data-color="#a95418"></div>
          <div class="color-option" style="background-color: #b17cc9" data-color="#b17cc9"></div>
          <div class="color-option" style="background-color: #9b59b6" data-color="#9b59b6"></div>
          <div class="color-option" style="background-color: #7c4792" data-color="#7c4792"></div>
          <div class="color-option" style="background-color: #5caee3" data-color="#5caee3"></div>
          <div class="color-option" style="background-color: #3498db" data-color="#3498db"></div>
          <div class="color-option" style="background-color: #2a7aaf" data-color="#2a7aaf"></div>
          <div class="color-option" style="background-color: #ed7669" data-color="#ed7669"></div>
          <div class="color-option" style="background-color: #e74c3c" data-color="#e74c3c"></div>
          <div class="color-option" style="background-color: #b93d30" data-color="#b93d30"></div>
          <div class="color-option" style="background-color: #4fc381" data-color="#4fc381"></div>
          <div class="color-option" style="background-color: #27ae60" data-color="#27ae60"></div>
          <div class="color-option" style="background-color: #1f8b4c" data-color="#1f8b4c"></div>
          <div class="color-option" style="background-color: #f4d33f" data-color="#f4d33f"></div>
          <div class="color-option" style="background-color: #f1c40f" data-color="#f1c40f"></div>
          <div class="color-option" style="background-color: #c19e0c" data-color="#c19e0c"></div>
          <div class="color-option" style="background-color: #a865c3" data-color="#a865c3"></div>
          <div class="color-option" style="background-color: #8e44ad" data-color="#8e44ad"></div>
          <div class="color-option" style="background-color: #72368a" data-color="#72368a"></div>
          <div class="color-option" style="background-color: #3bbca0" data-color="#3bbca0"></div>
          <div class="color-option" style="background-color: #16a085" data-color="#16a085"></div>
          <div class="color-option" style="background-color: #11806a" data-color="#11806a"></div>
          <div class="color-option" style="background-color: #ffffff" data-color="#ffffff"></div>
          <div class="color-option" style="background-color: #f5f5f5" data-color="#f5f5f5"></div>
          <div class="color-option" style="background-color: #e0e0e0" data-color="#e0e0e0"></div>
          <div class="color-option" style="background-color: #ff69b4" data-color="#ff69b4"></div>
          <div class="color-option" style="background-color: #ff1493" data-color="#ff1493"></div>
          <div class="color-option" style="background-color: #c71585" data-color="#c71585"></div>
          <div class="color-option" style="background-color: #00ffff" data-color="#00ffff"></div>
          <div class="color-option" style="background-color: #00ced1" data-color="#00ced1"></div>
          <div class="color-option" style="background-color: #008b8b" data-color="#008b8b"></div>
          <div class="color-option" style="background-color: #ffd700" data-color="#ffd700"></div>
          <div class="color-option" style="background-color: #daa520" data-color="#daa520"></div>
          <div class="color-option" style="background-color: #b8860b" data-color="#b8860b"></div>
          <div class="color-option" style="background-color: #ff6347" data-color="#ff6347"></div>
          <div class="color-option" style="background-color: #dc143c" data-color="#dc143c"></div>
          <div class="color-option" style="background-color: #a52a2a" data-color="#a52a2a"></div>
          <div class="color-option" style="background-color: #6a5acd" data-color="#6a5acd"></div>
          <div class="color-option" style="background-color: #483d8b" data-color="#483d8b"></div>
          <div class="color-option" style="background-color: #2f4f4f" data-color="#2f4f4f"></div>
          <div class="color-option" style="background-color: #9acd32" data-color="#9acd32"></div>
        </div>
      </div>
      <div class="qr-preview-wrapper">
        <div id="qrcode" class="qr-preview"></div>
        <div id="warningMessage"></div>
        <button class="backButton" id="backButton" style="display: none;" onclick="goBack()">Назад</button>
      </div>
    </div>
  </div>
  
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">×</span>
      <h3 id="modalHeader"></h3>
      <p id="modalContent"></p>
    </div>
  </div>
  
  <script>
    var lastWarningDetails = "";
    var qrCodeInstance = null;

    function updateForm() {
      var type = document.getElementById("qrType").value;
      document.getElementById("qrcode").innerHTML = "";
      clearWarning();
      var forms = ["urlForm","wifiForm","contactForm","textForm","mapForm","whatsappForm","phoneForm",
                   "emailForm","smsForm","paymentForm","skypeForm","telegramForm",
                   "facebookForm","instagramForm","linkedinForm","youtubeForm","viberForm","pinterestForm","xForm",
                   "tiktokForm","discordForm","snapchatForm","redditForm","twitchForm","signalForm","wechatForm","lineForm"];
      forms.forEach(function(formId) {
        document.getElementById(formId).style.display = (type === formId.replace("Form", "")) ? "block" : "none";
      });
      if (type === "wifi") {
        toggleWifiPassword();
      }
    }
    
    function toggleWifiPassword() {
      var encryption = document.getElementById("wifiEncryption").value;
      var wifiPassword = document.getElementById("wifiPassword");
      wifiPassword.disabled = encryption === "nopass";
      if (encryption === "nopass") wifiPassword.value = "";
    }
    
    function clearErrorStyles() {
      document.querySelectorAll("input, textarea, select").forEach(el => {
        el.style.border = "1px solid #ccc";
      });
    }
    
    function validateInput(input, pattern, errorMessage) {
      if (pattern && !pattern.test(input.value.trim())) {
        input.style.border = "2px solid red";
        showWarning(errorMessage, errorMessage);
        return false;
      }
      return true;
    }
    
    function applyFrameStyle(canvas) {
      const qrContainer = document.getElementById("qrcode");
      qrContainer.style.border = "none";
      qrContainer.style.borderRadius = "0";
      qrContainer.style.padding = "8px";
      qrContainer.style.background = "none";
      if (canvas) {
        canvas.style.border = "none";
      }
    }
    
    function generateQRCode() {
      if (localStorage.getItem('created_qr_codes')){
        localStorage.setItem('created_qr_codes', String(Number(localStorage.getItem('created_qr_codes')) + 1));
      }
      else{
        localStorage.setItem('created_qr_codes', '1');
      }
      clearWarning();
      clearErrorStyles();
      document.getElementById("qrcode").innerHTML = "";
      document.getElementById("qrContainer").style.display = "flex";
      document.querySelector('.form-container').style.display = 'none';
      document.getElementById('backButton').style.display = 'block';
      // Move backToMain to qrSettings top
      const backToMain = document.getElementById('backToMain');
      document.getElementById('qrSettings').insertBefore(backToMain, document.getElementById('qrSettings').firstChild);
      
      var type = document.getElementById("qrType").value;
      var qrText = "";
      var missingFields = [];
      
      if (type === "url") {
        var urlInput = document.getElementById("urlInput");
        var inputValue = urlInput.value.trim();
        if (inputValue.startsWith("@")) {
          if (!validateInput(urlInput, /^@[a-zA-Z0-9_]+$/, "Имя пользователя должно содержать только латинские буквы, цифры и подчеркивания")) {
            document.getElementById('qrSettings').style.display = 'none';
            return;
          }
          qrText = `https://t.me/${inputValue.substring(1)}`;
        } else if (!validateInput(urlInput, /^(https?:\/\/|t\.me\/).+/, "Введите корректный URL (начинается с http://, https:// или t.me/)")) {
          document.getElementById('qrSettings').style.display = 'none';
          return;
        } else {
          qrText = inputValue.startsWith("t.me/") ? `https://${inputValue}` : inputValue;
        }
      } else if (type === "wifi") {
        var wifiSSID = document.getElementById("wifiSSID");
        var wifiEncryption = document.getElementById("wifiEncryption");
        var wifiPassword = document.getElementById("wifiPassword");
        if (wifiSSID.value.trim() === "") {
          missingFields.push("SSID сети");
          wifiSSID.style.border = "2px solid red";
        }
        if (wifiEncryption.value !== "nopass" && wifiPassword.value.trim() === "") {
          missingFields.push("Пароль");
          wifiPassword.style.border = "2px solid red";
        }
        if (missingFields.length === 0) {
          qrText = `WIFI:S:${wifiSSID.value.trim()};T:${wifiEncryption.value};P:${wifiPassword.value.trim()};;`;
        } else {
          document.getElementById('qrSettings').style.display = 'none';
        }
      } else if (type === "contact") {
        var contactName = document.getElementById("contactName");
        var contactPhone = document.getElementById("contactPhone");
        var contactEmail = document.getElementById("contactEmail");
        if (!validateInput(contactName, /^[a-zA-Z\s]+$/, "Имя должно содержать только латинские буквы и пробелы")) {
          document.getElementById('qrSettings').style.display = 'none';
          return;
        }
        if (contactPhone.value.trim() === "") {
          missingFields.push("Телефон");
          contactPhone.style.border = "2px solid red";
        }
        if (!validateInput(contactEmail, /^[^\s@]+@[^\s@]+\.[^\s@]+$/, "Введите корректный Email")) {
          document.getElementById('qrSettings').style.display = 'none';
          return;
        }
        if (missingFields.length === 0) {
          qrText = `MECARD:N:${contactName.value.trim()};TEL:${contactPhone.value.trim()};EMAIL:${contactEmail.value.trim()};;`;
        } else {
          document.getElementById('qrSettings').style.display = 'none';
        }
      } else if (type === "text") {
        var textMessage = document.getElementById("textMessage");
        if (textMessage.value.trim() === "") {
          missingFields.push("Текстовое сообщение");
          textMessage.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = textMessage.value.trim();
        }
      } else if (type === "map") {
        var mapInput = document.getElementById("mapInput");
        if (mapInput.value.trim() === "") {
          missingFields.push("Адрес/Координаты");
          mapInput.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          var input = mapInput.value.trim();
          var coordRegex = /^\s*-?\d+(\.\d+)?\s*,\s*-?\d+(\.\d+)?\s*$/;
          qrText = coordRegex.test(input) ? `geo:${input}` : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(input)}`;
        }
      } else if (type === "whatsapp") {
        var whatsappPhone = document.getElementById("whatsappPhone");
        var whatsappMessage = document.getElementById("whatsappMessage");
        if (whatsappPhone.value.trim() === "") {
          missingFields.push("Телефон");
          whatsappPhone.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://wa.me/${whatsappPhone.value.trim()}${whatsappMessage.value.trim() ? "?text=" + encodeURIComponent(whatsappMessage.value.trim()) : ""}`;
        }
      } else if (type === "phone") {
        var phoneNumber = document.getElementById("phoneNumber");
        if (phoneNumber.value.trim() === "") {
          missingFields.push("Номер телефона");
          phoneNumber.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `tel:${phoneNumber.value.trim()}`;
        }
      } else if (type === "email") {
        var emailAddress = document.getElementById("emailAddress");
        var emailSubject = document.getElementById("emailSubject");
        var emailBody = document.getElementById("emailBody");
        if (!validateInput(emailAddress, /^[^\s@]+@[^\s@]+\.[^\s@]+$/, "Введите корректный Email")) {
          document.getElementById('qrSettings').style.display = 'none';
          return;
        }
        qrText = `mailto:${emailAddress.value.trim()}`;
        var params = [];
        if (emailSubject.value.trim()) params.push(`subject=${encodeURIComponent(emailSubject.value.trim())}`);
        if (emailBody.value.trim()) params.push(`body=${encodeURIComponent(emailBody.value.trim())}`);
        if (params.length) qrText += `?${params.join("&")}`;
      } else if (type === "sms") {
        var smsPhone = document.getElementById("smsPhone");
        var smsMessage = document.getElementById("smsMessage");
        if (smsPhone.value.trim() === "") {
          missingFields.push("Номер телефона");
          smsPhone.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `SMSTO:${smsPhone.value.trim()}:${smsMessage.value.trim()}`;
        }
      } else if (type === "payment") {
        var paymentAccount = document.getElementById("paymentAccount");
        var paymentAmount = document.getElementById("paymentAmount");
        var paymentDesc = document.getElementById("paymentDesc");
        if (paymentAccount.value.trim() === "") {
          missingFields.push("Номер счета");
          paymentAccount.style.border = "2px solid red";
        }
        if (paymentAmount.value.trim() === "") {
          missingFields.push("Сумма платежа");
          paymentAmount.style.border = "2px solid red";
        }
        if (missingFields.length === 0) {
          qrText = `PAYMENT:account=${paymentAccount.value.trim()}&amount=${paymentAmount.value.trim()}${paymentDesc.value.trim() ? "&desc=" + encodeURIComponent(paymentDesc.value.trim()) : ""}`;
        } else {
          document.getElementById('qrSettings').style.display = 'none';
        }
      } else if (type === "skype") {
        var skypeUsername = document.getElementById("skypeUsername");
        if (skypeUsername.value.trim() === "") {
          missingFields.push("Skype логин");
          skypeUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `skype:${skypeUsername.value.trim()}?chat`;
        }
      } else if (type === "telegram") {
        var telegramUsername = document.getElementById("telegramUsername");
        if (telegramUsername.value.trim() === "") {
          missingFields.push("Telegram логин");
          telegramUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://t.me/${telegramUsername.value.trim()}`;
        }
      } else if (type === "facebook") {
        var facebookUsername = document.getElementById("facebookUsername");
        if (facebookUsername.value.trim() === "") {
          missingFields.push("Facebook логин/ID");
          facebookUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.facebook.com/${facebookUsername.value.trim()}`;
        }
      } else if (type === "instagram") {
        var instagramUsername = document.getElementById("instagramUsername");
        if (instagramUsername.value.trim() === "") {
          missingFields.push("Instagram логин");
          instagramUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.instagram.com/${instagramUsername.value.trim()}`;
        }
      } else if (type === "linkedin") {
        var linkedinUsername = document.getElementById("linkedinUsername");
        if (linkedinUsername.value.trim() === "") {
          missingFields.push("LinkedIn логин");
          linkedinUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.linkedin.com/in/${linkedinUsername.value.trim()}`;
        }
      } else if (type === "youtube") {
        var youtubeChannel = document.getElementById("youtubeChannel");
        if (youtubeChannel.value.trim() === "") {
          missingFields.push("YouTube ID/ссылка");
          youtubeChannel.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.youtube.com/${youtubeChannel.value.trim()}`;
        }
      } else if (type === "viber") {
        var viberNumber = document.getElementById("viberNumber");
        if (viberNumber.value.trim() === "") {
          missingFields.push("Номер для Viber");
          viberNumber.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `viber://chat?number=${viberNumber.value.trim()}`;
        }
      } else if (type === "pinterest") {
        var pinterestUsername = document.getElementById("pinterestUsername");
        if (pinterestUsername.value.trim() === "") {
          missingFields.push("Pinterest логин");
          pinterestUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.pinterest.com/${pinterestUsername.value.trim()}`;
        }
      } else if (type === "x") {
        var xUsername = document.getElementById("xUsername");
        if (xUsername.value.trim() === "") {
          missingFields.push("X логин");
          xUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://x.com/${xUsername.value.trim()}`;
        }
      } else if (type === "tiktok") {
        var tiktokUsername = document.getElementById("tiktokUsername");
        if (tiktokUsername.value.trim() === "") {
          missingFields.push("TikTok логин");
          tiktokUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.tiktok.com/@${tiktokUsername.value.trim()}`;
        }
      } else if (type === "discord") {
        var discordUsername = document.getElementById("discordUsername");
        if (discordUsername.value.trim() === "") {
          missingFields.push("Discord логин/ID");
          discordUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://discord.gg/${discordUsername.value.trim()}`;
        }
      } else if (type === "snapchat") {
        var snapchatUsername = document.getElementById("snapchatUsername");
        if (snapchatUsername.value.trim() === "") {
          missingFields.push("Snapchat логин");
          snapchatUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.snapchat.com/add/${snapchatUsername.value.trim()}`;
        }
      } else if (type === "reddit") {
        var redditUsername = document.getElementById("redditUsername");
        if (redditUsername.value.trim() === "") {
          missingFields.push("Reddit логин");
          redditUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.reddit.com/user/${redditUsername.value.trim()}`;
        }
      } else if (type === "twitch") {
        var twitchUsername = document.getElementById("twitchUsername");
        if (twitchUsername.value.trim() === "") {
          missingFields.push("Twitch логин");
          twitchUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `https://www.twitch.tv/${twitchUsername.value.trim()}`;
        }
      } else if (type === "signal") {
        var signalNumber = document.getElementById("signalNumber");
        if (signalNumber.value.trim() === "") {
          missingFields.push("Номер для Signal");
          signalNumber.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `sgnl://signal.me/#p/${signalNumber.value.trim()}`;
        }
      } else if (type === "wechat") {
        var wechatUsername = document.getElementById("wechatUsername");
        if (wechatUsername.value.trim() === "") {
          missingFields.push("WeChat ID");
          wechatUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `weixin://contacts/profile/${wechatUsername.value.trim()}`;
        }
      } else if (type === "line") {
        var lineUsername = document.getElementById("lineUsername");
        if (lineUsername.value.trim() === "") {
          missingFields.push("Line ID");
          lineUsername.style.border = "2px solid red";
          document.getElementById('qrSettings').style.display = 'none';
        } else {
          qrText = `line://ti/p/@${lineUsername.value.trim()}`;
        }
      }
      
      if (missingFields.length > 0) {
        showWarning(`Пожалуйста, заполните: ${missingFields.join(", ")}.`, "Все обязательные поля должны быть заполнены.");
        document.getElementById('qrSettings').style.display = 'none';
        return;
      }
      
      if (qrText.trim()) {
        try {
          const size = parseInt(document.getElementById("qrSize").value);
          const color = document.querySelector('#colorPalette .color-option.selected')?.dataset.color || "#000000";
          const bgColor = document.querySelector('#backgroundColorPalette .color-option.selected')?.dataset.color || "#ffffff";
          let qrcodeDiv = document.getElementById("qrcode");
          qrcodeDiv.innerHTML = "";
          qrCodeInstance = new QRCode(qrcodeDiv, {
            text: qrText,
            width: size,
            height: size,
            colorDark: color,
            colorLight: bgColor,
            correctLevel: QRCode.CorrectLevel.H
          });
          document.getElementById('qrSettings').style.display = 'block';
          applyFrameStyle(qrcodeDiv.querySelector('canvas'));
        } catch (err) {
          showWarning("Ошибка генерации", "Произошла ошибка при генерации QR кода. Проверьте данные.");
          document.getElementById('qrSettings').style.display = 'none';
        }
      }
    }
    
    function showWarning(msg, details) {
      lastWarningDetails = details || "";
      var warningDiv = document.getElementById("warningMessage");
      warningDiv.innerHTML = `<h3>${msg}${lastWarningDetails ? " <button id='warningInfoBtn' onclick='showWarningDetails()'>?</button>" : ""}</h3>`;
    }
    
    function showWarningDetails() {
      if (lastWarningDetails) {
        document.getElementById("modalHeader").innerText = "Детали сообщения";
        document.getElementById("modalContent").innerText = lastWarningDetails;
        document.getElementById("infoModal").style.display = "block";
      }
    }
    
    function clearWarning() {
      document.getElementById("warningMessage").innerHTML = "";
      lastWarningDetails = "";
    }
    
    function showFieldInfo(field) {
      var header = "";
      var content = "";
      switch(field) {
        case 'url':
          header = "Ссылка";
          content = "Введите полный URL (http://, https://, t.me/) или Telegram username (@username).";
          break;
        case 'wifiSSID':
          header = "SSID сети";
          content = "Введите имя WiFi сети, например: MyNetwork.";
          break;
        case 'wifiEncryption':
          header = "Тип шифрования";
          content = "Выберите тип шифрования: WPA/WPA2, WEP или 'Нет пароля'.";
          break;
        case 'wifiPassword':
          header = "Пароль";
          content = "Введите пароль для WiFi сети. Если выбран 'Нет пароля', поле будет отключено.";
          break;
        case 'contactName':
          header = "Имя";
          content = "Введите имя контакта, используя только латинские буквы и пробелы.";
          break;
        case 'contactPhone':
          header = "Контакт: Телефон";
          content = "Введите номер телефона в любом формате, он будет автоматически отформатирован.";
          break;
        case 'contactEmail':
          header = "Email";
          content = "Введите корректный адрес электронной почты, например: user@example.com.";
          break;
        case 'textMessage':
          header = "Текстовое сообщение";
          content = "Введите сообщение, которое будет отображаться после сканирования QR кода.";
          break;
        case 'mapInput':
          header = "Карта";
          content = "Введите адрес или координаты (например, 'Москва, Красная площадь' или '55.7539,37.6208').";
          break;
        case 'whatsappPhone':
          header = "WhatsApp: Телефон";
          content = "Введите номер телефона с кодом страны (например, +1234567890).";
          break;
        case 'whatsappMessage':
          header = "WhatsApp: Сообщение";
          content = "Введите сообщение, которое будет предзаполнено при открытии чата (необязательно).";
          break;
        case 'phoneNumber':
          header = "Телефонный звонок";
          content = "Введите номер телефона в любом формате.";
          break;
        case 'emailAddress':
          header = "Email";
          content = "Введите корректный Email адрес, например: user@example.com.";
          break;
        case 'emailSubject':
          header = "Тема Email";
          content = "Введите тему письма (необязательно).";
          break;
        case 'emailBody':
          header = "Сообщение Email";
          content = "Введите текст письма (необязательно).";
          break;
        case 'smsPhone':
          header = "SMS: Телефон";
          content = "Введите номер телефона в любом формате.";
          break;
        case 'smsMessage':
          header = "SMS: Сообщение";
          content = "Введите сообщение для SMS (необязательно).";
          break;
        case 'paymentAccount':
          header = "Платеж: Номер счета";
          content = "Введите номер счета или идентификатор платежа.";
          break;
        case 'paymentAmount':
          header = "Платеж: Сумма";
          content = "Введите сумму платежа (положительное число).";
          break;
        case 'paymentDesc':
          header = "Платеж: Назначение";
          content = "Введите назначение платежа (необязательно).";
          break;
        case 'skypeUsername':
          header = "Skype";
          content = "Введите Skype логин для связи (например, live.username).";
          break;
        case 'telegramUsername':
          header = "Telegram";
          content = "Введите Telegram логин (без @) для перехода к чату.";
          break;
        case 'facebookUsername':
          header = "Facebook";
          content = "Введите Facebook логин или ID для перехода на профиль.";
          break;
        case 'instagramUsername':
          header = "Instagram";
          content = "Введите Instagram логин для перехода на профиль.";
          break;
        case 'linkedinUsername':
          header = "LinkedIn";
          content = "Введите LinkedIn логин для перехода на профиль.";
          break;
        case 'youtubeChannel':
          header = "YouTube";
          content = "Введите YouTube ID или ссылку на канал.";
          break;
        case 'viberNumber':
          header = "Viber";
          content = "Введите номер телефона для Viber в любом формате.";
          break;
        case 'pinterestUsername':
          header = "Pinterest";
          content = "Введите Pinterest логин для перехода на профиль.";
          break;
        case 'xUsername':
          header = "X";
          content = "Введите X логин для перехода на профиль.";
          break;
        case 'tiktokUsername':
          header = "TikTok";
          content = "Введите TikTok логин (без @) для перехода на профиль.";
          break;
        case 'discordUsername':
          header = "Discord";
          content = "Введите Discord логин или ID сервера для перехода.";
          break;
        case 'snapchatUsername':
          header = "Snapchat";
          content = "Введите Snapchat логин для добавления в друзья.";
          break;
        case 'redditUsername':
          header = "Reddit";
          content = "Введите Reddit логин для перехода на профиль.";
          break;
        case 'twitchUsername':
          header = "Twitch";
          content = "Введите Twitch логин для перехода на канал.";
          break;
        case 'signalNumber':
          header = "Signal";
          content = "Введите номер телефона для Signal в любом формате.";
          break;
        case 'wechatUsername':
          header = "WeChat";
          content = "Введите WeChat ID для перехода на профиль.";
          break;
        case 'lineUsername':
          header = "Line";
          content = "Введите Line ID для перехода на профиль.";
          break;
      }
      document.getElementById("modalHeader").innerText = header;
      document.getElementById("modalContent").innerText = content;
      document.getElementById("infoModal").style.display = "block";
    }
    
    function closeModal() {
      document.getElementById("infoModal").style.display = "none";
    }
    
    function goBack() {
      document.getElementById("qrcode").innerHTML = "";
      document.getElementById("qrContainer").style.display = "none";
      document.querySelector('.form-container').style.display = 'flex';
      document.getElementById('backButton').style.display = 'none';
      clearWarning();
      document.getElementById('qrSettings').style.display = 'block';
      // Move backToMain back to form-container top
      const backToMain = document.getElementById('backToMain');
      const formContainer = document.querySelector('.form-container');
      formContainer.insertBefore(backToMain, formContainer.firstChild);
    }
    
    function formatPhoneNumber(value) {
      const digits = value.replace(/\D/g, '');
      let formatted = '';
      if (digits.length > 0) formatted += '+' + digits.substring(0,3);
      if (digits.length >= 4) formatted += ' (' + digits.substring(3,5) + ')';
      else if (digits.length > 3) formatted += ' (' + digits.substring(3);
      if (digits.length >= 6) formatted += ' ' + digits.substring(5,8);
      else if (digits.length > 5) formatted += ' ' + digits.substring(5);
      if (digits.length >= 9) formatted += ' ' + digits.substring(8,10);
      else if (digits.length > 8) formatted += ' ' + digits.substring(8);
      if (digits.length >= 11) formatted += ' ' + digits.substring(10,12);
      else if (digits.length > 10) formatted += ' ' + digits.substring(10);
      return formatted;
    }

    function hexToRgb(hex) {
      hex = hex.replace('#', '');
      const r = parseInt(hex.substring(0, 2), 16);
      const g = parseInt(hex.substring(2, 4), 16);
      const b = parseInt(hex.substring(4, 6), 16);
      return { r, g, b };
    }

    function isDark(color) {
      const rgb = hexToRgb(color);
      const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;
      return luminance < 0.5;
    }

    function setSelectedBorder(opt) {
      if (opt.classList.contains('selected')) {
        const color = opt.dataset.color;
        opt.style.border = isDark(color) ? '2px solid blue' : '2px solid #000';
      } else {
        opt.style.border = '2px solid transparent';
      }
    }
    
    document.addEventListener("DOMContentLoaded", function() {
      var phoneInputs = document.querySelectorAll("input.phone-format");
      phoneInputs.forEach(function(input) {
        input.addEventListener("input", function(e) {
          input.value = formatPhoneNumber(input.value);
        });
      });
      
      document.getElementById("qrSize").addEventListener("input", function() {
        if (qrCodeInstance) {
          document.getElementById("qrcode").innerHTML = "";
          const size = parseInt(this.value);
          const color = document.querySelector('#colorPalette .color-option.selected')?.dataset.color || "#000000";
          const bgColor = document.querySelector('#backgroundColorPalette .color-option.selected')?.dataset.color || "#ffffff";
          qrCodeInstance = new QRCode(document.getElementById("qrcode"), {
            text: qrCodeInstance._htOption.text,
            width: size,
            height: size,
            colorDark: color,
            colorLight: bgColor,
            correctLevel: QRCode.CorrectLevel.H
          });
          applyFrameStyle(document.querySelector('#qrcode canvas'));
        }
      });
      
      function setupColorPalette(paletteId) {
        document.getElementById(paletteId).addEventListener("click", function(e) {
          if (e.target.classList.contains("color-option")) {
            const options = document.querySelectorAll(`#${paletteId} .color-option`);
            options.forEach(opt => {
              opt.classList.remove("selected");
              setSelectedBorder(opt);
            });
            e.target.classList.add("selected");
            setSelectedBorder(e.target);
            if (qrCodeInstance) {
              document.getElementById("qrcode").innerHTML = "";
              const size = parseInt(document.getElementById("qrSize").value);
              const color = document.querySelector('#colorPalette .color-option.selected')?.dataset.color || "#000000";
              const bgColor = document.querySelector('#backgroundColorPalette .color-option.selected')?.dataset.color || "#ffffff";
              qrCodeInstance = new QRCode(document.getElementById("qrcode"), {
                text: qrCodeInstance._htOption.text,
                width: size,
                height: size,
                colorDark: color,
                colorLight: bgColor,
                correctLevel: QRCode.CorrectLevel.H
              });
              applyFrameStyle(document.querySelector('#qrcode canvas'));
            }
          }
        });
      }

      setupColorPalette("colorPalette");
      setupColorPalette("backgroundColorPalette");

      const defaultColor = document.querySelector("#colorPalette .color-option[data-color='#000000']");
      defaultColor.classList.add("selected");
      setSelectedBorder(defaultColor);

      const defaultBgColor = document.querySelector("#backgroundColorPalette .color-option[data-color='#ffffff']");
      defaultBgColor.classList.add("selected");
      setSelectedBorder(defaultBgColor);
    });
  </script>
</body>
</html>