<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ò–ò</title>
  <style>
    /* –°–±—Ä–æ—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ box-sizing */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #74ABE2, #5563DE);
      margin: 0;
      padding-top: 20px; /* –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
      display: flex;
      justify-content: center; /* –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
      align-items: flex-start; /* –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ö—É */
      min-height: 100vh;
      min-width: 475px;
    }

    .chat-container {
      width: 100%;
      max-width: 600px;
      max-height: 90vh; /* –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—ã—Å–æ—Ç–µ, —á—Ç–æ–±—ã –Ω–µ –≤—ã—Ö–æ–¥–∏–ª–æ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞ */
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      margin-top: 4%;
    }

    .chat-header {
      background-color: #5563DE;
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 22px;
    }

    .chat-messages {
      flex: 1;
      padding: 20px;
      background-color: #f4f4f4;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .message {
      display: flex;
      max-width: 70%;
      word-wrap: break-word;
      padding: 12px 18px;
      border-radius: 18px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .message.user {
      align-self: flex-end;
      background-color: #dcf8c6;
    }

    .message.ai {
      align-self: flex-start;
      background-color: #ffffff;
    }

    /* –°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–±–ª–æ–∫ –æ—Ü–µ–Ω–∫–∏) */
    .message.rating {
      align-self: center;
      background-color: #e9ecef;
      border-radius: 10px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      position: relative;
    }

    .rating p {
      margin: 0;
      font-weight: bold;
    }

    .stars {
      display: flex;
      gap: 5px;
      font-size: 24px;
      cursor: pointer;
    }

    .stars .star {
      user-select: none;
    }

    .rating button {
      background-color: #5563DE;
      color: #fff;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s;
      margin: 0 5px;
    }

    .rating button:hover {
      background-color: #3b45a0;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    .disabled {
      opacity: 0.5;
      background-color: #ccc !important;
      pointer-events: none;
      cursor: default;
      color: #888 !important;
    }

    /* –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (–∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤–º–µ—Å—Ç–æ alert) */
    .error-message {
      color: red;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      margin: 10px 0;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 200;
    }
    .modal {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      width: 300px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      text-align: center;
    }
    .modal p {
      font-size: 16px;
      margin-bottom: 10px;
    }
    .modal input {
      width: 90%;
      padding: 6px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    .modal button {
      padding: 8px 12px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      background-color: #5563DE;
      color: #fff;
      cursor: pointer;
      margin-right: 5px;
      transition: background-color 0.2s;
    }
    .modal button:hover {
      background-color: #3b45a0;
    }
    .modal button.cancel {
      background-color: #ccc;
      color: #333;
    }
    .modal button.cancel:hover {
      background-color: #b3b3b3;
    }

    .chat-input {
      display: flex;
      border-top: 1px solid #ddd;
    }
    .chat-input input {
      flex: 1;
      padding: 15px;
      border: none;
      font-size: 16px;
      outline: none;
    }
    .chat-input button {
      background: linear-gradient(135deg, #5563DE, #74ABE2);
      border: none;
      color: #fff;
      padding: 0 25px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border-radius: 0 10px 10px 0;
    }
    .chat-input button:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* –°—Ç–∏–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–µ—á–∞—Ç–∏ (–º–∞–ª–µ–Ω—å–∫–∏–µ –∫—Ä—É–∂–æ—á–∫–∏) */
    .typing-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .typing-indicator .dot {
      width: 6px;
      height: 6px;
      margin: 0 3px;
      background-color: #5563DE;
      border-radius: 50%;
      opacity: 0.5;
      animation: blink 1.4s infinite;
    }
    .typing-indicator .dot:nth-child(1) {
      animation-delay: 0s;
    }
    .typing-indicator .dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .typing-indicator .dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes blink {
      0%, 80%, 100% {
        opacity: 0.5;
        transform: translateY(0);
      }
      40% {
        opacity: 1;
        transform: translateY(-5px);
      }
    }

    /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
    @media (max-width: 600px) {
      .chat-container {
        margin: 10px;
        border-radius: 8px;
        margin-top: 8%;
      }
      .chat-header {
        font-size: 20px;
        padding: 15px;
      }
      .chat-input input {
        padding: 10px;
        font-size: 14px;
      }
      .chat-input button {
        padding: 0 20px;
        font-size: 14px;
      }
      .stars {
        font-size: 20px;
      }
      .modal {
        width: 90%;
      }
    }

    @media (max-width: 400px) {
      .chat-container {
        border-radius: 0;
        margin-top: 5%;
      }
      .chat-header {
        font-size: 18px;
        padding: 10px;
      }
      .chat-input input {
        font-size: 14px;
        padding: 8px;
      }
      .chat-input button {
        font-size: 14px;
        padding: 0 15px;
      }
    }
  </style>
</head>
<body>
    <button 
    onclick="window.location.href = 'main.html'" 
    style="position: absolute; top: 10px; left: 10px; padding: 10px 20px; font-size: 16px;"
>
    –í–ï–†–ù–£–¢–¨–°–Ø –í –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ
    </button>

  <div class="chat-container">
    <div class="chat-header">–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</div>
    <div class="chat-messages" id="chat-messages"></div>
    <div class="chat-input">
      <input type="text" id="message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off" />
      <button id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>

  <script>
    // –ú–∞—Å—Å–∏–≤ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
    const adminQna = [
      { 
        question: "–ü—Ä–æ–±–ª–µ–º–∞ —Å –±–æ—Ç–æ–º", 
        keywords: ['–æ—à–∏–±–∫–∞', '–ø—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è', '—Å–æ–∂–∞–ª–µ–µ–º', '–°–æ–∂–∞–ª–µ–µ–º, –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞.'], 
        answer: '–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º, —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ @Clickerstart_bot .<br>–¢–∞–∫-–∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å –≤–∞–º –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É.'
      },
      { 
        question: "–ß—Ç–æ –¥–µ–ª–∞—Ç—å?", 
        keywords: ['—Ä–∞–±–æ—Ç–∞', '–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', '–∏–∑–≤–∏–Ω–∏—Ç–µ, '], 
        answer: '–ü—Ä–æ–≤–æ–¥–∏—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ä—ã–≤. <br>–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–∏–º –±–æ—Ç–æ–º @Clickerstart_bot.' 
      },
      { 
        question: "–ü–æ–º–æ—â—å", 
        keywords: ['–ø–æ–º–æ—â—å', '–ø–æ–º–æ–≥–∏—Ç–µ', '–ø–æ–¥–¥–µ—Ä–∂–∫–∞', '–ø–æ–º–æ–≥–∏'], 
        answer: '–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?<br>–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –Ω–∞–ø–∏—à–∏—Ç–µ "–ê–¥–º–∏–Ω"'
      },
      { 
        question: "–ü–æ–Ω—è—Ç–Ω–æ", 
        keywords: ['–ø–æ–Ω—è–ª', '–ø–æ–Ω—è—Ç–Ω–æ', '—è—Å–Ω–æ'], 
        answer: "–Ø —Ä–∞–¥, —á—Ç–æ —Å–º–æ–≥ –≤–∞–º –æ–±—ä—è—Å–Ω–∏—Ç—å :)" 
      },
      { 
        question: "—Å–≤—è–∑—å", 
        keywords: ['–Ω–µ –ø–æ–Ω–∏–º–∞—é', '–∞–¥–º–∏–Ω'], 
        answer: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–∏–º –±–æ—Ç–æ–º –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏: @Clickerstart_bot.' 
      },
      { 
        question: "–ü–æ–¥–¥–µ—Ä–∂–∫–∞", 
        keywords: ['–ø–æ–¥–¥–µ—Ä–∂–∫–∞'], 
        answer: '–ú—ã –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å! –ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å.' 
      },
      { 
        question: "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ", 
        keywords: ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ', '–∫—É'], 
        answer: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? <br>(–ù–∞—à Telegram –±–æ—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏: @Clickerstart_bot)' 
      },
      { 
        question: "–•–æ—Ä–æ—à–æ", 
        keywords: ['—Ö–æ—Ä–æ—à–æ', '–ª–∞–¥–Ω–æ', '–æ–∫–µ–π'], 
        answer: 'üôÇ' 
      },
      { 
        question: "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å", 
        keywords: ['—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä—é', '—Å–ø—Å'], 
        answer: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ üòÑ" 
      },
      { 
        question: "–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç", 
        keywords: ['–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç', '–Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç', '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', '–∏–≥–Ω–æ—Ä'], 
        answer: `–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:<br><br>1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Telegram, Wi-Fi –∏–ª–∏ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.<br>–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –≤ –≤–∞—à–µ–º Telegram, WI-FI –∏–ª–∏ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ<br><br>2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.<br>–ò–Ω–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ –±—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ–π.<br><br>3. –í—ã–∫–ª—é—á–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–∞ –ø–∞—Ä—É –º–∏–Ω—É—Ç.<br>–ò–Ω–æ–≥–¥–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–æ–∂–µ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å.<br><br>4. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à Telegram<br>–ö—ç—à –≤–∞—à–µ–≥–æ Telegram —Å–æ–≤–µ—Ç—É–µ–º –æ—á–∏—Å—Ç–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–≥–æ Telegram –≤ —Ä–∞–∑–¥–µ–ª–µ "–î–∞–Ω–Ω—ã–µ –∏ –ø–∞–º—è—Ç—å".<br><br>–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –∏–∑ —ç—Ç–æ–≥–æ –≤–∞–º –Ω–µ –ø–æ–º–æ–≥–ª–æ, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ "–ü–æ–º–æ–≥–∏—Ç–µ"` 
      },
      { 
        question: "–ß—Ç–æ —Ç—ã —É–º–µ–µ—à—å?", 
        keywords: ['—É–º–µ–µ—à—å?', '—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å?', '—á–æ –º–æ–∂–µ—à—å', '–¥–µ–ª–∞—Ç—å'], 
        answer: `–Ø —É–º–µ—é —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –Ω–∞—à–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤(–±–æ—Ç–æ–≤ –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π) –∏ –ø–æ–º–æ–≥–∞—Ç—å –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö.` 
      }
    ];

    const defaultMessage = "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ —Å–º–æ–≥ –Ω–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å.<br>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–∏–º –±–æ—Ç–æ–º –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏: @Clickerstart_bot.";

    const messageInput = document.getElementById('message');
    const sendBtn = document.getElementById('send-btn');
    const chatMessages = document.getElementById('chat-messages');

    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è Telegram
    const telegramToken = '6537497957:AAGZS4adwPVJSlx16YCCDrKjO96rDK7ZstI';
    const telegramChatId = '6434781065';

    let userMessageCount = 0;
    let ratingDisplayed = false;
    let selectedStars = 0;
    let ratingDisabled = false;  // –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    let ratingSent = false;      // —Ñ–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
    let systemTypingActive = false; // —Ñ–ª–∞–≥, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø–µ—á–∞—Ç–∞–µ—Ç

    // –°—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    let ratingDiv = null;
    let reasonBtn = null;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–º–µ—Å—Ç–æ alert)
    function showError(message) {
      const errorHeading = document.createElement('h3');
      errorHeading.classList.add('error-message');
      errorHeading.textContent = message;
      chatMessages.appendChild(errorHeading);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      setTimeout(() => {
        errorHeading.remove();
      }, 3000);
    }

    function appendMessage(sender, text) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', sender);
      messageDiv.innerHTML = text;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getAnswer(inputText) {
      const lowerText = inputText.toLowerCase();
      for (const { keywords, answer } of adminQna) {
        if (keywords.some(keyword => lowerText.includes(keyword))) {
          return answer;
        }
      }
      return defaultMessage;
    }

    function containsForbiddenWords(text) {
    // –ü—Ä–∏–≤–æ–¥–∏–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    const lowerText = text.toLowerCase();
    // –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤ (–≤—Å–µ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ)
    const forbiddenWords = [
      '–±–ª—è–¥—å', '—Å—É–∫–∞', '—Ö—É–π', '–ø–∏–∑–¥–µ—Ü', '–µ–±–∞—Ç—å', '–Ω–∞—Ö—É–π', '–≥–æ–≤–Ω–æ', '–¥–µ—Ä—å–º–æ', '–ø–∏–∑–¥–∞', '–∏–¥–∏–æ—Ç', '—Ç—É–ø–æ–π',
      '–º—Ä–∞–∑—å', '—É–±–ª—é–¥–æ–∫', '–ø–∏–¥–æ—Ä', '–ø–∏–¥–æ—Ä–∞—Å', '—Å–≤–æ–ª–æ—á—å', '–≥–∞–Ω–¥–æ–Ω', '–ø–∏–∑–¥—é–∫', '–¥–æ–ª–±–æ–µ–±',
      '–µ–±–∞–Ω—É—Ç—ã–π', '–º—É–¥–∞–∫', '–∫–æ–Ω—á–µ–Ω—ã–π', '—Ö–µ—Ä', '–∂–æ–ø–∞', '—Ç–≤–∞—Ä—å', '–ª–æ—Ö', '–≥–µ–π', '–ª–µ—Å–±–∏—è–Ω–∫–∞', '—Ç—É–ø–æ–π', '–µ–±–ª–∞–Ω', '–µ–±–∞–Ω', '–µ–±–∞–Ω–∞—à–∫–∞'
    ];
    
    // –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º true
    return forbiddenWords.some(word => lowerText.includes(word));
  }


    function processMessage() {
      // –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –µ—â—ë –ø–µ—á–∞—Ç–∞–µ—Ç, –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
      if (systemTypingActive) return;
      const text = messageInput.value.trim();
      if (!text) return;
      
      // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Ç—ã –∏–ª–∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è
      if (containsForbiddenWords(text)) {
        messageInput.value = ''; // –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        updateSendButtonVisibility();
        appendMessage('ai', '–î–∞–≤–∞–π—Ç–µ –Ω–µ –±—É–¥–µ–º –º–∞—Ç–µ—Ä–∏—Ç—å—Å—è.');
        return; // –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –¥–∞–ª—å–Ω–µ–π—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
      }
      
      appendMessage('user', text);
      messageInput.value = '';
      updateSendButtonVisibility();
      userMessageCount++;
      setTimeout(() => {
        const answer = getAnswer(text);
        appendMessage('ai', answer);
        if (userMessageCount === 3 && !ratingDisplayed) {
          showRatingMessage();
          ratingDisplayed = true;
        }
      }, 500);
    }

    sendBtn.addEventListener('click', processMessage);
    messageInput.addEventListener('keypress', e => {
      // –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ Enter –∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–µ—á–∞—Ç–∞–µ—Ç
      if (e.key === 'Enter' && !systemTypingActive) {
        processMessage();
      }
    });

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
    // –ö–Ω–æ–ø–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–µ –ø—É—Å—Ç–æ–µ –∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–µ—á–∞—Ç–∞–µ—Ç
    function updateSendButtonVisibility() {
      if (messageInput.value.trim() !== '' && !systemTypingActive) {
        sendBtn.style.display = "inline-block";
      } else {
        sendBtn.style.display = "none";
      }
    }

    messageInput.addEventListener("input", updateSendButtonVisibility);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–µ—á–∞—Ç–∏ (–ø—Ä—ã–≥–∞—é—â–∏–µ –∫—Ä—É–∂–æ—á–∫–∏)
    function showTypingIndicator() {
      const indicator = document.createElement('div');
      indicator.classList.add('message', 'ai');
      indicator.innerHTML = '<div class="typing-indicator"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
      chatMessages.appendChild(indicator);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      return indicator;
    }

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, –æ—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏, –∑–∞—Ç–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã —É–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –≤—ã–≤–æ–¥–∏–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏
    window.onload = () => {
      systemTypingActive = true;
      updateSendButtonVisibility();
      const indicator = showTypingIndicator();
      setTimeout(() => {
        systemTypingActive = false;
        indicator.remove();
        appendMessage('ai', '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —á–µ–º —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?<br><br>–ß—Ç–æ–±—ã –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ "–ê–¥–º–∏–Ω"');
        updateSendButtonVisibility();
      }, 3000);
    };

    // –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∞ –æ—Ü–µ–Ω–∫–∏
    function showRatingMessage() {
      ratingDiv = document.createElement('div');
      ratingDiv.classList.add('message', 'rating');

      const ratingText = document.createElement('p');
      ratingText.textContent = '–û—Ü–µ–Ω–∏—Ç–µ –Ω–∞—à—É –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç 1 –¥–æ 5 –∑–≤–µ–∑–¥:';

      const starsDiv = document.createElement('div');
      starsDiv.classList.add('stars');
      for (let i = 1; i <= 5; i++) {
        const starSpan = document.createElement('span');
        starSpan.classList.add('star');
        starSpan.dataset.value = i;
        starSpan.textContent = '‚òÜ';
        starSpan.addEventListener('click', () => {
          if (ratingDisabled) return;
          selectedStars = i;
          updateStarsDisplay(starsDiv);
        });
        starsDiv.appendChild(starSpan);
      }

      const sendRatingBtn = document.createElement('button');
      sendRatingBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
      sendRatingBtn.addEventListener('click', sendRating);

      reasonBtn = document.createElement('button');
      reasonBtn.textContent = '–ü—Ä–∏—á–∏–Ω–∞';
      reasonBtn.style.display = 'none';
      reasonBtn.addEventListener('click', openImprovementWindow);

      const buttonsDiv = document.createElement('div');
      buttonsDiv.appendChild(sendRatingBtn);
      buttonsDiv.appendChild(reasonBtn);

      ratingDiv.appendChild(ratingText);
      ratingDiv.appendChild(starsDiv);
      ratingDiv.appendChild(buttonsDiv);

      chatMessages.appendChild(ratingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–≤—ë–∑–¥
    function updateStarsDisplay(starsDiv) {
      const starSpans = starsDiv.querySelectorAll('.star');
      starSpans.forEach(star => {
        const starValue = Number(star.dataset.value);
        star.textContent = starValue <= selectedStars ? '‚òÖ' : '‚òÜ';
      });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ü–µ–Ω–∫–∏ –≤ Telegram –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    function sendRating() {
      if (ratingDisabled) return;
      if (selectedStars === 0) {
        showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥ –¥–ª—è –æ—Ü–µ–Ω–∫–∏.');
        return;
      }
      const ratingMsg = `–ö—Ç–æ-—Ç–æ –æ—Ü–µ–Ω–∏–ª –Ω–∞—à—É –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–∞ ${selectedStars} ${selectedStars === 1 ? '–∑–≤–µ–∑–¥—É' : '–∑–≤–µ–∑–¥—ã'}!`;
      const url = `https://api.telegram.org/bot${telegramToken}/sendMessage?chat_id=${telegramChatId}&text=${encodeURIComponent(ratingMsg)}`;

      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.ok) {
            ratingSent = true;
            if (selectedStars <= 3) {
              appendMessage('ai', '–ü—Ä–∏–Ω–æ—Å–∏–º –∏–∑–≤–∏–Ω–µ–Ω–∏—è –∑–∞ –≤–æ–∑–Ω–∏–∫—à–∏–µ –ø—Ä–æ–±–ª–µ–º—ã. –ú—ã –ø–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è —É–ª—É—á—à–∏—Ç—å—Å—è!');
              disableRatingMessage({ allowReason: true });
              reasonBtn.style.display = 'inline-block';
            } else {
              appendMessage('ai', '–°–ø–∞—Å–∏–±–æ!');
              disableRatingMessage({ allowReason: false });
            }
          } else {
            showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ü–µ–Ω–∫–∏ –≤ Telegram.');
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞:', error);
          showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ü–µ–Ω–∫–∏.');
        });
    }

    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
    // –ï—Å–ª–∏ allowReason==true, –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫—Ä–æ–º–µ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏—á–∏–Ω–∞" –∏ —Ç–µ–∫—Å—Ç–∞.
    function disableRatingMessage({ allowReason }) {
      ratingDisabled = true;
      if (ratingDiv) {
        const buttons = ratingDiv.querySelectorAll('button');
        buttons.forEach(btn => {
          if (allowReason && btn === reasonBtn) {
            // –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–∏—á–∏–Ω–∞"
          } else {
            btn.disabled = true;
            btn.classList.add('disabled');
          }
        });
        const stars = ratingDiv.querySelectorAll('.star');
        stars.forEach(star => {
          star.style.pointerEvents = 'none';
          star.style.color = '#888';
        });
        const ratingText = ratingDiv.querySelector('p');
        if (ratingText) {
          ratingText.classList.add('disabled');
        }
      }
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –≤–≤–æ–¥–∞ –ø—Ä–∏—á–∏–Ω—ã
    function openImprovementWindow() {
      if (!ratingDisabled) return;
      if (document.querySelector('.modal-overlay')) return;

      const overlay = document.createElement('div');
      overlay.classList.add('modal-overlay');

      const modal = document.createElement('div');
      modal.classList.add('modal');

      const promptText = document.createElement('p');
      promptText.textContent = '–ü–æ—á–µ–º—É –≤—ã –¥–∞–ª–∏ —Ç–∞–∫—É—é –æ—Ü–µ–Ω–∫—É?';

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = '–í–∞—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è';

      const sendImpBtn = document.createElement('button');
      sendImpBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
      sendImpBtn.disabled = true;
      sendImpBtn.classList.add('disabled');
      input.addEventListener('input', () => {
        if (input.value.trim() === '') {
          sendImpBtn.disabled = true;
          sendImpBtn.classList.add('disabled');
        } else {
          sendImpBtn.disabled = false;
          sendImpBtn.classList.remove('disabled');
        }
      });
      sendImpBtn.addEventListener('click', () => {
        const suggestion = input.value.trim();
        if (!suggestion) {
          showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.');
          return;
        }
        const impText = `–ö—Ç–æ-—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–∏–ª —É–ª—É—á—à–µ–Ω–∏—è: ${suggestion}`;
        const impUrl = `https://api.telegram.org/bot${telegramToken}/sendMessage?chat_id=${telegramChatId}&text=${encodeURIComponent(impText)}`;
        fetch(impUrl)
          .then(response => response.json())
          .then(data => {
            if (data.ok) {
              overlay.remove();
              reasonBtn.disabled = true;
              reasonBtn.classList.add('disabled');
            } else {
              showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.');
            }
          })
          .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.');
          });
      });

      const cancelBtn = document.createElement('button');
      cancelBtn.textContent = '–û—Ç–º–µ–Ω–∞';
      cancelBtn.classList.add('cancel');
      cancelBtn.addEventListener('click', () => {
        overlay.remove();
      });

      modal.appendChild(promptText);
      modal.appendChild(input);
      modal.appendChild(sendImpBtn);
      modal.appendChild(cancelBtn);

      overlay.appendChild(modal);
      document.body.appendChild(overlay);
    }
  </script>
</body>
</html>
