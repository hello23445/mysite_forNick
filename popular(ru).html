<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Топ-лист</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #060039;
            flex-direction: column;
        }
        #content {
            display: none;
            flex-direction: column;
            align-items: center;
        }
        #top-list {
            list-style-type: none;
            padding: 0;
        }
        #top-list li {
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: darkblue;
            color: white;
            border: none;
            border-radius: 5px;
            width: 300px;
            text-align: left;
            margin: 10px 0;
        }
        button:hover {
            background-color: blue;
        }
        #loader {
            color: white;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div id="loader">Загрузка...</div>
    <div id="content">
        <h2 style="color: white;">
            Топ-3 популярных генераторов<br>(количество генераций)
        </h2>
        <ol id="top-list"></ol>
    </div>
    <button onclick="window.location.href='main.html';">Вернуться в главное меню</button>  <!-- Укажите путь здесь -->

    <script>
        // Массив с ссылками на отдельные файлы (укажите пути здесь)
        const links = {
            'Никнейм': 'nickname.html',  // Замените на реальный путь
            'Описание': 'description.html',  // Замените на реальный путь
            'ИИ-Генератор': 'ai.html'  // Замените на реальный путь
        };

        // URL вашего Google Apps Script веб-приложения (замените на реальный)
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbxO6PDIfjeFElwOhySAG9EH9izpsJLxrju3jQonTYiyZF46NPDFePJGe2w1OoJ2fcyN/exec';  // Укажите ваш deployment ID

        let isInitialLoad = true;

        async function fetchData() {
            if (isInitialLoad) {
                document.getElementById('loader').style.display = 'block';
                document.getElementById('content').style.display = 'none';
            }
            try {
                const response = await fetch(GAS_URL);
                if (!response.ok) {
                    throw new Error('Ошибка при получении данных: ' + response.status);
                }
                const data = await response.json();
                // Предполагаем, что GAS возвращает JSON: { a2: num, b2: num, c2: num }
                console.log('Полученные данные:', data);
                updateTopList(data.a2, data.b2, data.c2);
                if (isInitialLoad) {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('content').style.display = 'flex';
                    isInitialLoad = false;
                }
            } catch (error) {
                console.error('Ошибка:', error);
                if (isInitialLoad) {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('content').style.display = 'flex';  // Показать контент даже при ошибке (список будет пустым)
                    isInitialLoad = false;
                }
            }
        }

        function updateTopList(nicknames, descriptions, photos) {
            const items = [
                { name: 'Никнейм', count: parseInt(nicknames) || 0, url: links['Никнейм'] },
                { name: 'Описание', count: parseInt(descriptions) || 0, url: links['Описание'] },
                { name: 'ИИ-Генератор', count: parseInt(photos) || 0, url: links['ИИ-Генератор'] }
            ];

            // Сортировка по count от большего к меньшему
            items.sort((a, b) => b.count - a.count);

            const list = document.getElementById('top-list');
            list.innerHTML = '';  // Очистка списка

            items.forEach((item, index) => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.textContent = `${index + 1}. ${item.name}(${item.count})`;
                button.onclick = () => {
                    window.location.href = item.url;
                };
                li.appendChild(button);
                list.appendChild(li);
            });
        }

        // Загрузка данных при входе
        fetchData();

        // Обновление каждые 2 секунды
        setInterval(fetchData, 2000);
    </script>
</body>
</html>