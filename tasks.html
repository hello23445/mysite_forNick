<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –Ω–∞–≥—Ä–∞–¥—ã</title>
  <style>
    :root{
      --bg:#060039;
      --text:#d9d9d9;
      --accent:#251897;
      --card:#0b0b2b;
      --glass: rgba(255,255,255,0.03);
      --success: #22c55e;
      --error: #ef4444;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased}
    .app{max-width:1100px;margin:24px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .back-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:10px 14px;border-radius:12px;text-decoration:none;font-weight:600}
    .coins{font-weight:700}
    main{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:20px}

    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(2,2,8,0.6)}
    .calendar{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
    .day{background:var(--card);border-radius:12px;padding:12px;height:88px;display:flex;flex-direction:column;justify-content:space-between}
    .day.claimed{opacity:0.6;box-shadow:inset 0 0 0 2px rgba(0,0,0,0.2)}
    .day.today{outline:2px solid rgba(37,24,151,0.5)}
    .day .num{font-weight:700}
    .day .reward{font-size:13px}
    .day button{margin-top:8px;padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:white;font-weight:600;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:13px;}

    .tasks-list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .task{background:var(--glass);border-radius:12px;padding:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
    .task .title{font-weight:700}
    .task .meta{font-size:13px;opacity:0.85;margin-top:6px}
    .task .buttons{display:flex;gap:8px;margin-top:10px}
    .btn{padding:8px 10px;border-radius:10px;border:none;background:var(--accent);color:white;font-weight:700;cursor:pointer;transition: background 0.2s;}
    .btn:hover{background:#3a2ab8;}
    .btn.alt{background:transparent;border:1px solid rgba(255,255,255,0.06);transition: border-color 0.2s;}
    .btn.alt:hover{border-color:rgba(255,255,255,0.12);}

    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;z-index:1000;transition: opacity 0.3s ease;}
    .modal-content{background:var(--card);padding:24px;border-radius:16px;max-width:420px;width:90%;text-align:left;position:relative;box-shadow:0 4px 20px rgba(0,0,0,0.3);animation: fadeIn 0.3s ease;}
    @keyframes fadeIn {from {opacity:0;transform:scale(0.95);} to {opacity:1;transform:scale(1);}}
    .modal-content h1{font-size:20px;font-weight:700;margin-bottom:12px;text-align:center;}
    .modal-content .description{margin-bottom:16px;line-height:1.5;font-size:14px;}
    .modal-content .meta{font-size:16px;font-weight:bold;opacity:0.9;margin-bottom:8px;}
    .modal-content .buttons{display:flex;flex-direction:column;gap:12px;margin-top:20px;}
    .modal-content .buttons button{width:100%;}
    .close-btn{position:absolute;top:16px;right:16px;cursor:pointer;color:var(--text);font-size:24px;transition: color 0.2s;}
    .close-btn:hover{color:white;}

    .toast{display:flex;align-items:center;position:fixed;bottom:40px;left:50%;transform:translateX(-50%);background:var(--card);border-radius:12px;padding:16px;max-width:400px;width:calc(100% - 40px);box-shadow:0 4px 12px rgba(0,0,0,0.4);z-index:9999;animation:slideUp 0.3s ease-out;color:var(--text);}
    @keyframes slideUp{from{opacity:0;transform:translate(-50%,20px);}to{opacity:1;transform:translate(-50%,0);}}
    .toast-icon{display:flex;align-items:center;justify-content:center;flex-shrink:0;width:32px;height:32px;border-radius:50%;}
    .toast.success .toast-icon{background:rgba(34,197,94,0.2);color:var(--success);}
    .toast.error .toast-icon{background:rgba(239,68,68,0.2);color:var(--error);}
    .toast-text{margin-left:12px;font-size:16px;font-weight:500;flex:1;}
    .toast-close{margin-left:auto;background:none;border:none;color:var(--text);opacity:0.6;cursor:pointer;padding:0 8px;transition:opacity 0.2s;}
    .toast-close:hover{opacity:1;}
    .toast svg{width:20px;height:20px;}

    .side{position:sticky;top:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px}
    .progress{height:10px;background:rgba(255,255,255,0.04);border-radius:10px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#5b3cff);width:0%}

    footer{margin-top:18px;text-align:center;color:rgba(217,217,217,0.6);font-size:13px}

    @media (max-width:900px){
      main{grid-template-columns:1fr}
      .coins{font-size:14px}
    }
    @media (max-width:768px){
      .calendar{grid-template-columns:repeat(3,1fr)}
      body {font-size:14px;}
      .day {height:70px; padding:10px;}
      .day .num {font-size:15px;}
      .day .reward {font-size:11px;}
      .day button {font-size:11px; padding:6px 8px;}
      .task .title {font-size:14px;}
      .task .meta {font-size:11px;}
      .btn {font-size:12px; padding:6px 8px;}
      .calendar {gap:8px;}
      .tasks-list {gap:8px;}
      .modal-content {padding:16px;}
      .modal-content h1 {font-size:18px;}
      .modal-content .description {font-size:12px;}
      .modal-content .meta {font-size:14px;}
      .app {padding:10px;}
      header {gap:8px;}
      .back-btn {font-size:14px; padding:8px 12px;}
      .coins {font-size:14px;}
      footer {font-size:11px;}
    }
    @media (max-width:480px){
      body {font-size:12px;}
      .day {height:60px; padding:8px;}
      .day .num {font-size:13px;}
      .day .reward {font-size:10px;}
      .day button {font-size:10px; padding:5px 7px;}
      .task .title {font-size:12px;}
      .task .meta {font-size:10px;}
      .btn {font-size:10px; padding:5px 7px;}
      .calendar {grid-template-columns:repeat(2,1fr); gap:6px;}
      .modal-content {padding:12px; max-width:90%;}
      .modal-content h1 {font-size:16px;}
      .modal-content .description {font-size:11px;}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <a class="back-btn" href="main.html">–í–ï–†–ù–£–¢–¨–°–Ø –í –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</a>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="coins" id="coinsDisplay">ü™ô0</div>
      </div>
    </header>

    <main>
      <section class="panel">
        <h2>–ù–∞–≥—Ä–∞–¥—ã</h2>
        <p style="opacity:0.8">–ù–∞–≥—Ä–∞–¥—ã –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –ø–æ –æ–¥–Ω–æ–π –≤ –¥–µ–Ω—å. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ü—Ä–µ–º–∏—É–º, —Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±–∏—Ä–∞—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã.</p>

        <div style="margin-top:14px">
          <div class="calendar" id="calendar"></div>
        </div>
      </section>

      <aside class="side">
        <div class="card">
          <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
            <div>–î–Ω–µ–π —Å–æ–±—Ä–∞–Ω–æ: <span id="collectedCount">0</span>/30</div>
            <div id="currentDayLabel">–î–µ–Ω—å 1</div>
          </div>
          <div style="margin-top:10px" class="progress"><i id="progressBar"></i></div>
          <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
            <button class="btn" id="collectToday">–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É (—Å–µ–≥–æ–¥–Ω—è)</button>
            <button class="btn alt" id="collectAllMissed">–ó–∞–±—Ä–∞—Ç—å –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card" style="margin-top:12px">
          <h3>
            –ó–∞–¥–∞–Ω–∏—è
            (–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–µ –∑–∞–¥–∞–Ω–∏–µ —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏)
          </h3>
          <div class="tasks-list" id="tasksList"></div>
        </div>
      </aside>
    </main>

    <footer>
      –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—ë –∑–∞–¥–∞–Ω–∏–µ, —Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏: –í–ï–†–ù–£–¢–¨–°–Ø –í –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ > –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ú–µ–Ω—é > –ù–∞—Å—Ç—Ä–æ–π–∫–∏ > –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–≤—è–∑—å"> –ù–∞–∂–º–∏—Ç–µ "–ù–∞–ø–∏—Å–∞—Ç—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏"
    </footer>
  </div>

  <!-- Modal -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">√ó</span>
      <h1 id="modalTitle"></h1>
      <div class="description" id="modalDescription"></div>
      <div id="modalExpires" class="meta"></div>
      <div id="modalReward" class="meta"></div>
      <div class="buttons">
        <button class="btn alt" id="modalActionBtn"></button>
        <button class="btn" id="modalCheckBtn"></button>
        <button class="btn alt" id="modalBackBtn">–ù–∞–∑–∞–¥</button>
      </div>
    </div>
  </div>

  <script>
    /* ----------------------
       1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≥—Ä–∞–¥: 29-–π = 10 000, 30-–π = 50 000
       ----------------------*/
    let DAILY_REWARDS = JSON.parse(localStorage.getItem('dailyRewards') || 'null');
    if (!DAILY_REWARDS) {
      DAILY_REWARDS = [];
      const start = 100;
      const end = 5000;
      const days = 28;
      const increment = Math.floor((end - start) / (days - 1));
      for (let i = 0; i < days; i++) {
        DAILY_REWARDS.push(start + i * increment);
      }
      DAILY_REWARDS.push(10000);  // 29-–π –¥–µ–Ω—å
      DAILY_REWARDS.push(50000);  // 30-–π –¥–µ–Ω—å
      localStorage.setItem('dailyRewards', JSON.stringify(DAILY_REWARDS));
    }

    /* ----------------------
       2. –ê–≤—Ç–æ-—Å–±—Ä–æ—Å –∫–∞–ª–µ–Ω–¥–∞—Ä—è –ø–æ—Å–ª–µ 30-–≥–æ –¥–Ω—è
       ----------------------*/
    function resetCycleIfNeeded() {
      const claimed = getClaimed();
      const todayIndex = dayIndexFromStart();
      if (claimed.includes(29) && todayIndex >= 30) {
        localStorage.setItem('rewardsStart', new Date().toISOString().slice(0,10));
        localStorage.setItem('claimedDays', JSON.stringify([]));
        renderAll();
      }
    }

    /* ----------------------
       3. –í—Å–µ –∑–∞–¥–∞–Ω–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
       ----------------------*/
    const TASKS = [
      {
        id: 'task1',
        title: '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª',
        description: '–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏',
        actionLink: 'https://t.me/NickNaymes2Bot',
        conditionCode: 'return await checkSubscription("@NickNaymes2Bot");',
        expires: '',
        rewardText: '1 000',
        rewardCode: 'return 1000;',
        showConditionCode: 'return localStorage.getItem("userID")'
      },
      {
        id: 'task2',
        title: '–ü—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π Telegram ID',
        description: `–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π Telegram ID –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.\n1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.\n2. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ú–µ–Ω—é".\n3. –í—ã–±–µ—Ä–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏".\n4. –í —Ä–∞–∑–¥–µ–ª–µ "–ê–∫–∫–∞—É–Ω—Ç" –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram ID" –∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π ID.\n5. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".`,
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
        actionLink: 'main.html',
        conditionCode: "return !!localStorage.getItem('userID');",
        expires: '',
        rewardText: '500',
        rewardCode: 'return 500;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task3',
        title: '–î–æ–±–∞–≤–∏—Ç—å –Ω–∏–∫–Ω–µ–π–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ',
        description: `–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±–æ–π –Ω–∏–∫–Ω–µ–π–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.`,
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
        actionLink: 'main.html',
        conditionCode: "return !!localStorage.getItem('loved');",
        expires: '',
        rewardText: '255',
        rewardCode: 'return 255;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task4',
        title: '–î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ',
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ª—é–±–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
        actionLink: 'main.html',
        conditionCode: "return !!localStorage.getItem('loved_descs');",
        expires: '',
        rewardText: '255',
        rewardCode: 'return 255;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task5',
        title: '–ö—É–ø–∏—Ç—å –ª—é–±–æ–π —Ç–æ–≤–∞—Ä –≤ –º–∞–≥–∞–∑–∏–Ω–µ',
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –∫—É–ø–∏—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –ª—é–±–æ–π —Ç–æ–≤–∞—Ä –≤ –º–∞–≥–∞–∑–∏–Ω–µ.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω',
        actionLink: 'shop_ru.html',
        conditionCode: "return !!localStorage.getItem('bought');",
        expires: '',
        rewardText: '200',
        rewardCode: 'return 200;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task6',
        title: '–ö—É–ø–∏—Ç—å –ü—Ä–µ–º–∏—É–º',
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –∫—É–ø–∏—Ç—å –ü—Ä–µ–º–∏—É–º.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ –ü—Ä–µ–º–∏—É–º–∞',
        actionLink: 'premium.screen.html',
        conditionCode: "return !!localStorage.getItem('premium');",
        expires: '',
        rewardText: '200 000',
        rewardCode: 'return 200000;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task7',
        title: '–°–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –ø–µ—Ä–≤—É—é –õ–ï–ì–û-—Ñ–∏–≥—É—Ä–∫—É',
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –ªego-—Ñ–∏–≥—É—Ä–∫—É.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –õ–ï–ì–û-—Ñ–∏–≥—É—Ä–∫–∏',
        actionLink: 'main.html',
        conditionCode: "return !!localStorage.getItem('created_lego');",
        expires: '',
        rewardText: '555',
        rewardCode: 'return 555;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task8',
        title: function() { return `–°–æ–∑–¥–∞—Ç—å –õ–ï–ì–û-—Ñ–∏–≥—É—Ä–∫—É 8 —à—Ç—É–∫(${localStorage.getItem('created_lego')||0}/8)`; },
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –ªego-—Ñ–∏–≥—É—Ä–∫—É 8 —à—Ç—É–∫.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –õ–ï–ì–û-—Ñ–∏–≥—É—Ä–∫–∏',
        actionLink: 'main.html',
        conditionCode: "return await checkCountForTasks(localStorage.getItem('created_lego'), 8);",
        expires: '',
        rewardText: '800',
        rewardCode: 'return 800;',
        showConditionCode: 'return !!localStorage.getItem("created_lego")'
      },
      {
        id: 'task9',
        title: '–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é –ø–µ—Ä–≤—É—é –ê–≤–∞—Ç–∞—Ä–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª—å.',
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∞–≤–∞—Ç–∞—Ä–∫—É.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å',
        actionLink: 'user_profile.html',
        conditionCode: "return await checkAvatarForTask()",
        expires: '',
        rewardText: '300',
        rewardCode: 'return 300;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task10',
        title: '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª.',
        description: '–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–∞–Ω–∞–ª',
        actionLink: 'https://t.me/online1_Islam',
        conditionCode: "return await checkSubscription('@online1_Islam');",
        expires: '',
        rewardText: '1 000',
        rewardCode: 'return 1000;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task11',
        title: function() { return `–°–æ–∑–¥–∞—Ç—å 18 –Ω–∏–∫–Ω–µ–π–º–æ–≤(${localStorage.getItem('created_nicknames')||0}/18)`; },
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å 18 –Ω–∏–∫–Ω–µ–π–º–æ–≤.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–∏–∫–Ω–µ–π–º–æ–≤',
        actionLink: 'nickname.html',
        conditionCode: "return await checkCountForTasks(localStorage.getItem('created_nicknames'), 18);",
        expires: '',
        rewardText: '1 000',
        rewardCode: 'return 1000;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task12',
        title: '–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∞–≤–∞—Ç–∞—Ä–∫—É',
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∞–≤–∞—Ç–∞—Ä–∫—É.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∞–≤–∞—Ç–∞—Ä–∫–∏',
        actionLink: 'avatar.html',
        conditionCode: "return localStorage.getItem('created_profiles')",
        expires: '',
        rewardText: '200',
        rewardCode: 'return 200;',
        showConditionCode: 'return true;'
      },
      {
        id: 'task13',
        title: function() { return `–°–æ–∑–¥–∞–π—Ç–µ 5 –∞–≤–∞—Ç–∞—Ä–æ–∫(${localStorage.getItem('created_profiles')||0}/5)`; },
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫–∏ 5 —à—Ç—É–∫.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∞–≤–∞—Ç–∞—Ä–∫–∏',
        actionLink: 'avatar.html',
        conditionCode: "return await checkCountForTasks(localStorage.getItem('created_profiles'), 5);",
        expires: '',
        rewardText: '600',
        rewardCode: 'return 600;',
        showConditionCode: "return localStorage.getItem('task12_claimed') === 'true';"
      },
      {
        id: 'task14',
        title: function() { return `–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–Ω–Ω—ã–º –Ω–∏–∫–Ω–µ–π–º–æ–º —Å –¥—Ä—É–∑—å—è–º–∏(${localStorage.getItem('shared_nicknames')||0}/3)`; },
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–Ω—ã–º –Ω–∏–∫–Ω–µ–π–º–æ–º —Å –¥—Ä—É–∑—å—è–º–∏ 3 —Ä–∞–∑–∞.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–∏–∫–Ω–µ–π–º–æ–≤',
        actionLink: 'nickname.html',
        conditionCode: "return await checkCountForTasks(localStorage.getItem('shared_nicknames'), 3);",
        expires: '',
        rewardText: '400',
        rewardCode: 'return 300;',
        showConditionCode: "return true;"
      },
      {
        id: 'task15',
        title: function() { return `–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–Ω–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å –¥—Ä—É–∑—å—è–º–∏(${localStorage.getItem('shared_descriptions')||0}/3)`; },
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å –¥—Ä—É–∑—å—è–º–∏ 3 —Ä–∞–∑–∞.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –æ–ø–∏—Å–∞–Ω–∏–π',
        actionLink: 'description.html',
        conditionCode: "return await checkCountForTasks(localStorage.getItem('shared_descriptions'), 3);",
        expires: '',
        rewardText: '400',
        rewardCode: 'return 300;',
        showConditionCode: "return true;"
      },
      {
        id: 'task20',
        title: `–ü—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –∏–º—è –≤ –º–µ–Ω—é "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å"`,
        description: '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–¥—É–º–∞—Ç—å —Å–µ–±–µ –∏–º—è –≤ –º–µ–Ω—é "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å".',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å',
        actionLink: 'user_profile.html',
        conditionCode: "return localStorage.getItem('userName') !== 'User'",
        expires: '',
        rewardText: '266',
        rewardCode: 'return 266;',
        showConditionCode: "return true;"
      },
    ];

    function checkAvatarForTask() {
      return localStorage.getItem('userAvatar') !== 'user_profile_photo.png';
    }

    async function checkCountForTasks(count, required) {
      return (Number(count) || 0) >= required;
    }

    async function checkSubscription(CHANNEL_ID) {
      const BOT_TOKEN = "6537497957:AAGZS4adwPVJSlx16YCCDrKjO96rDK7ZstI";
      const USER_ID = localStorage.getItem('userID');
      try {
        const url = `https://api.telegram.org/bot${BOT_TOKEN}/getChatMember?chat_id=${CHANNEL_ID}&user_id=${USER_ID}`;
        const response = await fetch(url);
        const data = await response.json();
        if (!data.ok) return false;
        const status = data.result.status;
        return ["member", "administrator", "creator"].includes(status);
      } catch (err) {
        console.error(err);
        return false;
      }
    }

    /* ----------------------
       –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
       ----------------------*/
    if (!localStorage.getItem('coins')) localStorage.setItem('coins', '0');
    if (!localStorage.getItem('rewardsStart')) localStorage.setItem('rewardsStart', new Date().toISOString().slice(0,10));
    if (!localStorage.getItem('claimedDays')) localStorage.setItem('claimedDays', JSON.stringify([]));

    const coinsDisplay = document.getElementById('coinsDisplay');
    const calendarEl = document.getElementById('calendar');
    const tasksList = document.getElementById('tasksList');
    const collectedCountEl = document.getElementById('collectedCount');
    const progressBar = document.getElementById('progressBar');
    const currentDayLabel = document.getElementById('currentDayLabel');
    const collectTodayBtn = document.getElementById('collectToday');
    const collectAllMissedBtn = document.getElementById('collectAllMissed');

    function getCoins() { return parseInt(localStorage.getItem('coins') || '0', 10); }
    function setCoins(n) { localStorage.setItem('coins', String(n)); renderCoins(); }
    function renderCoins() { coinsDisplay.textContent = `ü™ô${getCoins()}`; }

    function getStartDate() { return new Date(localStorage.getItem('rewardsStart')); }
    function dayIndexFromStart() {
      const diff = Math.floor((Date.UTC(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()) -
        Date.UTC(getStartDate().getFullYear(), getStartDate().getMonth(), getStartDate().getDate())) / 86400000);
      return Math.max(0, diff);
    }

    function getClaimed() { try { return JSON.parse(localStorage.getItem('claimedDays') || '[]'); } catch { return []; } }
    function setClaimed(arr) { localStorage.setItem('claimedDays', JSON.stringify(arr)); }

    function canClaimIndex(index) {
      if (getClaimed().includes(index)) return false;
      const today = dayIndexFromStart();
      if (index === today) return true;
      if (index < today) return localStorage.getItem('premium') === 'yes';
      return false;
    }

    function claimIndex(index) {
      if (!canClaimIndex(index)) return false;
      setCoins(getCoins() + DAILY_REWARDS[index]);
      const claimed = getClaimed();
      claimed.push(index);
      setClaimed(claimed);
      renderAll();
      return true;
    }

    function claimAllMissed() {
      if (localStorage.getItem('premium') !== 'yes') {
        showToast('–¢—Ä–µ–±—É–µ—Ç—Å—è Premium', 'error');
        return;
      }
      let total = 0;
      for (let i = 0; i < dayIndexFromStart(); i++) {
        if (!getClaimed().includes(i)) {
          total += DAILY_REWARDS[i];
          claimIndex(i);
        }
      }
      if (total > 0) showToast(`–ü–æ–ª—É—á–µ–Ω–æ ${total}ü™ô –∑–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–Ω–∏!`, 'success');
    }

    function parseDateDDMMYYYY(s) {
      if (!s) return null;
      const [d, m, y] = s.split('.').map(Number);
      return new Date(y, m - 1, d);
    }

    function isTaskExpired(task) {
      if (!task.expires) return false;
      const exp = parseDateDDMMYYYY(task.expires);
      if (!exp) return false;
      const today = new Date();
      today.setHours(0,0,0,0);
      return exp < today;
    }

    function renderCalendar() {
      calendarEl.innerHTML = '';
      const claimed = getClaimed();
      const todayIndex = dayIndexFromStart();
      const now = new Date();

      for (let i = 0; i < 30; i++) {
        const day = document.createElement('div');
        day.className = 'day';
        if (claimed.includes(i)) day.classList.add('claimed');
        if (i === todayIndex) day.classList.add('today');

        day.innerHTML = `<div><div class="num">–î–µ–Ω—å ${i+1}</div><div class="reward">${DAILY_REWARDS[i]}ü™ô</div></div>`;
        const btn = document.createElement('button');

        if (claimed.includes(i)) {
          btn.textContent = '–ü–æ–ª—É—á–µ–Ω–æ'; btn.disabled = true; btn.style.opacity = 0.6;
        } else if (i > todayIndex) {
          const future = new Date(getStartDate());
          future.setDate(future.getDate() + i);
          const diff = future - now;
          const d = Math.floor(diff / 86400000);
          const h = Math.floor((diff % 86400000) / 3600000);
          const m = Math.floor((diff % 3600000) / 60000);
          const s = Math.floor((diff % 60000) / 1000);
          btn.textContent = `${String(d).padStart(2,'0')} –¥. ${String(h).padStart(2,'0')}—á. ${String(m).padStart(2,'0')}–º. ${String(s).padStart(2,'0')}—Å.`;
          btn.disabled = true;
        } else if (i < todayIndex && localStorage.getItem('premium') !== 'yes') {
          btn.textContent = 'Premium'; btn.disabled = true;
        } else {
          btn.textContent = '–ó–∞–±—Ä–∞—Ç—å';
          btn.onclick = () => {
            if (claimIndex(i)) showToast(`–ü–æ–ª—É—á–µ–Ω–æ ${DAILY_REWARDS[i]}ü™ô`, 'success');
            else showToast('–ù–µ–ª—å–∑—è –∑–∞–±—Ä–∞—Ç—å', 'error');
          };
        }
        day.appendChild(btn);
        calendarEl.appendChild(day);
      }
    }

    function renderTasks() {
      tasksList.innerHTML = '';
      for (const t of TASKS) {
        let show = true;
        if (t.showConditionCode) {
          try { show = new Function(t.showConditionCode)(); } catch { show = false; }
        }
        if (!show) continue;

        const taskEl = document.createElement('div');
        taskEl.className = 'task';
        const expired = isTaskExpired(t);
        const claimed = !!localStorage.getItem(t.id + '_claimed');

        const title = typeof t.title === 'function' ? t.title() : t.title;
        taskEl.innerHTML = `<div class="title">${title} (${t.rewardText}ü™ô)</div>`;
        const btn = document.createElement('button');
        btn.className = 'btn';

        if (claimed) {
          btn.textContent = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; btn.disabled = true; btn.style.opacity = 0.6;
        } else if (expired) {
          btn.textContent = '–ò—Å—Ç—ë–∫'; btn.disabled = true; btn.style.opacity = 0.6;
        } else {
          btn.textContent = t.checkText;
          btn.onclick = async (e) => {
            e.stopPropagation();
            if (expired) {
              showToast('–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –∏—Å—Ç—ë–∫.', 'error');
              return;
            }
            try {
              const fn = new Function('return async function(){' + t.conditionCode + '}')();
              const ok = await fn();
              if (ok) {
                const reward = new Function(t.rewardCode)();
                setCoins(getCoins() + reward);
                localStorage.setItem(t.id + '_claimed', 'true');
                showToast(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª—É—á–µ–Ω–æ ${reward}ü™ô`, 'success');
                renderAll();
              } else {
                showToast('–£—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'error');
              }
            } catch (err) {
              console.error(err);
              showToast('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏', 'error');
            }
          };
        }
        taskEl.appendChild(btn);
        taskEl.onclick = () => showModal(t);
        tasksList.appendChild(taskEl);
      }
    }

    function renderProgress() {
      const claimed = getClaimed().length;
      progressBar.style.width = Math.round((claimed / 30) * 100) + '%';
      collectedCountEl.textContent = claimed;
      currentDayLabel.textContent = `–î–µ–Ω—å ${dayIndexFromStart() + 1}`;
    }

    function renderCollectToday() {
      const today = dayIndexFromStart();
      if (getClaimed().includes(today)) {
        collectTodayBtn.textContent = '–ó–∞–±—Ä–∞–Ω–æ (—Å–µ–≥–æ–¥–Ω—è)';
        collectTodayBtn.disabled = true;
        collectTodayBtn.style.opacity = 0.6;
      } else {
        collectTodayBtn.textContent = '–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É (—Å–µ–≥–æ–¥–Ω—è)';
        collectTodayBtn.disabled = false;
        collectTodayBtn.style.opacity = 1;
      }
    }

    function renderCollectAllMissed() {
      const isPremium = localStorage.getItem('premium') === 'yes';
      collectAllMissedBtn.textContent = isPremium
        ? '–ó–∞–±—Ä–∞—Ç—å –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã'
        : '–ó–∞–±—Ä–∞—Ç—å –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã (Premium)';
      collectAllMissedBtn.disabled = !isPremium;
      collectAllMissedBtn.style.opacity = isPremium ? 1 : 0.6;
    }

    function renderAll() {
      renderCoins();
      renderCalendar();
      renderTasks();
      renderProgress();
      renderCollectToday();
      renderCollectAllMissed();
      resetCycleIfNeeded();
    }

    collectTodayBtn.onclick = () => {
      const today = dayIndexFromStart();
      if (claimIndex(today)) showToast(`–ü–æ–ª—É—á–µ–Ω–æ ${DAILY_REWARDS[today]}ü™ô`, 'success');
      else showToast('–°–µ–≥–æ–¥–Ω—è —É–∂–µ –∑–∞–±—Ä–∞–ª–∏', 'error');
    };

    collectAllMissedBtn.onclick = claimAllMissed;

    function showToast(text, type = 'info') {
      document.querySelectorAll('.toast').forEach(t => t.remove());
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      const icon = type === 'success'
        ? `<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/></svg>`
        : `<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z"/></svg>`;
      toast.innerHTML = `
        <div class="toast-icon">${icon}</div>
        <div class="toast-text">${text}</div>
        <button class="toast-close"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/></svg></button>
      `;
      document.body.appendChild(toast);
      toast.querySelector('.toast-close').onclick = () => toast.remove();
      setTimeout(() => toast.remove(), 5000);
    }

    const modal = document.getElementById('taskModal');
    const closeModal = document.getElementById('closeModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDescription = document.getElementById('modalDescription');
    const modalExpires = document.getElementById('modalExpires');
    const modalReward = document.getElementById('modalReward');
    const modalActionBtn = document.getElementById('modalActionBtn');
    const modalCheckBtn = document.getElementById('modalCheckBtn');
    const modalBackBtn = document.getElementById('modalBackBtn');

    function showModal(task) {
      modalTitle.textContent = typeof task.title === 'function' ? task.title() : task.title;
      modalDescription.textContent = task.description;
      modalReward.textContent = `–ù–∞–≥—Ä–∞–¥–∞: ${task.rewardText} –º–æ–Ω–µ—Çü™ô`;
      const expired = isTaskExpired(task);
      modalExpires.textContent = task.expires ? `–î–æ: ${task.expires}${expired ? ' ¬∑ –ò—Å—Ç—ë–∫' : ''}` : '';
      modalActionBtn.textContent = task.actionText;
      modalActionBtn.onclick = () => location.href = task.actionLink;

      const claimed = !!localStorage.getItem(task.id + '_claimed');
      if (claimed || expired) {
        modalCheckBtn.textContent = claimed ? '–ó–∞–±—Ä–∞–Ω–æ' : '–ò—Å—Ç—ë–∫';
        modalCheckBtn.disabled = true;
        modalCheckBtn.style.opacity = 0.6;
      } else {
        modalCheckBtn.textContent = task.checkText;
        modalCheckBtn.onclick = async () => {
          if (expired) { showToast('–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –∏—Å—Ç—ë–∫.', 'error'); return; }
          try {
            const fn = new Function('return async function(){' + task.conditionCode + '}')();
            const ok = await fn();
            if (ok) {
              const reward = new Function(t.rewardCode)();
              setCoins(getCoins() + reward);
              localStorage.setItem(task.id + '_claimed', 'true');
              showToast(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª—É—á–µ–Ω–æ ${reward}ü™ô`, 'success');
              renderAll();
              modal.style.display = 'none';
            } else {
              showToast('–£—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'error');
            }
          } catch (e) { showToast('–û—à–∏–±–∫–∞', 'error'); }
        };
      }
      modal.style.display = 'flex';
    }

    closeModal.onclick = modalBackBtn.onclick = () => modal.style.display = 'none';
    window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };

    renderAll();
    setInterval(() => {
      renderCalendar();
      renderCollectToday();
      renderCollectAllMissed();
      resetCycleIfNeeded();
    }, 1000);

    window.APP = { TASKS, DAILY_REWARDS };
  </script>
</body>
</html>