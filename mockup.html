<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Studio Pro | 3D Perspective</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0b0f19; color: white; margin: 0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 3D */
        .perspective-container {
            perspective: 1200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #device-frame {
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), border-color 0.3s ease;
            transform-style: preserve-3d;
            border-style: solid;
        }

        .active-btn { 
            border-color: #3b82f6 !important; 
            background: rgba(59, 130, 246, 0.2) !important; 
            color: #fff !important;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        #screen-bg {
            width: 100%; height: 100%;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            transition: background-image 0.3s;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        @keyframes toast {
            0% { transform: translateY(100px); opacity: 0; }
            10% { transform: translateY(0); opacity: 1; }
            90% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(100px); opacity: 0; }
        }
        #toast { display: none; animation: toast 3s forwards; }

        /* –ü—Ä–µ–ª–æ–∞–¥–µ—Ä –≤–∏–¥–µ–æ */
        .spinner { width:28px; height:28px; border:3px solid rgba(255,255,255,0.08); border-top-color:#3b82f6; border-radius:50%; animation:spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:60}
        .modal{background:#0f1724;padding:18px;border-radius:12px;max-width:420px;color:#e6edf3;border:1px solid rgba(255,255,255,0.04);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
        .modal .modal-title{font-weight:600;margin-bottom:8px;color:#60a5fa}
        .modal .modal-body{font-size:13px;color:#cbd5e1;margin-bottom:12px}
        .modal .modal-actions{display:flex;gap:8px;justify-content:flex-end}
        .modal .btn{padding:8px 12px;border-radius:8px;background:#111827;color:#fff;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
        .modal .btn.primary{background:#3b82f6}

        /* Drag and Drop */
        .drag-over {
            border-color: #3b82f6 !important;
            background: rgba(59, 130, 246, 0.3) !important;
        }

        /* –°–∫—Ä–æ–ª –¥–ª—è —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        .device-scroll { max-height: 200px; overflow-y: auto; }

        /* –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤ */
        #keyboard { 
            display: none; 
            width: 100%; 
            height: 60px; 
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%); 
            border-radius: 0 0 inherit inherit; 
            position: absolute; 
            bottom: 0; 
            left: 0;
            padding: 8px;
            box-sizing: border-box;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            align-content: flex-start;
            overflow: hidden;
        }
        
        #keyboard::before {
            content: '';
            position: absolute;
            width: 90%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            top: 0;
            left: 5%;
        }
        
        .key {
            width: 8%; height: 18px; background: #333; border: 1px solid #222; border-radius: 2px; flex-shrink: 0;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] bg-green-500 text-white px-8 py-4 rounded-2xl shadow-2xl font-bold flex items-center gap-3">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        –ú–æ–∫–∞–ø –≥–æ—Ç–æ–≤!
    </div>

    <header class="py-4 border-b border-gray-800 bg-slate-900/50 backdrop-blur-md sticky top-0 z-50 px-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tighter">MOCKUP<span class="text-blue-500">GEN</span></h1>
            <span class="text-[10px] text-gray-500 font-mono border border-gray-800 px-2 py-1 rounded">PRO EDITION v3</span>
        </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-6 p-6">
        
        <div class="lg:col-span-4 space-y-3 pr-2">
            
            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">1. –ö–æ–Ω—Ç–µ–Ω—Ç —ç–∫—Ä–∞–Ω–∞</h3>
                <input type="file" id="contentUpload" class="hidden" />
                <div id="dropZone" class="w-full py-3 border-2 border-dashed border-slate-700 rounded-xl text-xs text-slate-400 hover:border-blue-500 hover:text-blue-400 transition-all cursor-pointer text-center"
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('contentUpload').click()">
                    üìé <span id="dropZoneText">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ</span>
                </div>
                <p id="premiumMessage" class="text-[8px] font-bold text-blue-400 mt-2 uppercase tracking-widest text-center" style="display:none;">
                    –ö—É–ø–∏—Ç–µ Premium, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–∏–¥–µ–æ
                </p>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">2. –ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h3>
                <div class="device-scroll grid grid-cols-1 gap-1" id="deviceList"></div>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">3. –¶–≤–µ—Ç –∫–æ—Ä–ø—É—Å–∞</h3>
                <div class="flex flex-wrap gap-2 items-center" id="colorPalette"></div>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">4. –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ</h3>
                <div class="grid grid-cols-2 gap-2" id="positionList"></div>
            </div>

            <button onclick="sendMockup()" id="sendBtn" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-2xl font-bold text-white shadow-xl shadow-blue-900/30 transition-all transform active:scale-95 flex items-center justify-center gap-3 flex-shrink-0">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                –ü–û–î–ï–õ–ò–¢–¨–°–Ø
            </button>
        </div>

        <div class="lg:col-span-8 glass rounded-[2.5rem] flex items-center justify-center relative bg-slate-950 overflow-auto p-4" style="min-height: calc(100vh - 120px);">
            <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: linear-gradient(#3b82f6 1px, transparent 1px), linear-gradient(90deg, #3b82f6 1px, transparent 1px); background-size: 40px 40px;"></div>
            
            <div id="capture-area" class="perspective-container py-12">
                <div id="device-frame" class="relative shadow-[0_50px_100px_-20px_rgba(0,0,0,1)]">
                    <div id="notch" class="absolute left-1/2 -translate-x-1/2 bg-black z-20"></div>
                    <div id="screen" class="absolute top-0 left-0 w-full overflow-hidden bg-black" style="height: 100%;">
                        <div id="screen-bg" style="background-image: url('https://images.unsplash.com/photo-1616348436168-de43ad0db179?q=80&w=1000');"></div>
                    </div>
                    <div class="absolute inset-0 pointer-events-none z-30 bg-gradient-to-tr from-white/5 via-transparent to-transparent rounded-[inherit]"></div>
                    <div id="keyboard"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ====================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –£–¢–ò–õ–ò–¢–´ ======================
        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.arcTo(x + width, y, x + width, y + radius, radius);
            ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
            ctx.arcTo(x, y + height, x, y + height - radius, radius);
            ctx.arcTo(x, y, x + radius, y, radius);
            ctx.closePath();
        }

        const devices = {
            // iPhone
            "iPhone 11":        { w: 278, h: 580, r: '40px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 12":        { w: 280, h: 590, r: '40px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 12 Pro":    { w: 280, h: 590, r: '40px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 13":        { w: 290, h: 600, r: '42px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 13 Pro":    { w: 290, h: 600, r: '42px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 13 Pro Max":{ w: 320, h: 660, r: '46px', b: '12px', type: 'island', category: 'iPhone' },
            "iPhone 14":        { w: 292, h: 605, r: '43px', b: '9px',  type: 'notch', category: 'iPhone' },
            "iPhone 14 Plus":   { w: 320, h: 665, r: '48px', b: '12px', type: 'notch', category: 'iPhone', premium: true },
            "iPhone 14 Pro":    { w: 295, h: 610, r: '46px', b: '8px',  type: 'island', category: 'iPhone' },
            "iPhone 14 Pro Max":{ w: 325, h: 670, r: '50px', b: '12px', type: 'island', category: 'iPhone', premium: true },
            "iPhone 15":        { w: 293, h: 608, r: '44px', b: '8px',  type: 'notch', category: 'iPhone' },
            "iPhone 15 Plus":   { w: 322, h: 668, r: '48px', b: '12px', type: 'notch', category: 'iPhone', premium: true },
            "iPhone 15 Pro":    { w: 295, h: 610, r: '48px', b: '7px',  type: 'island', category: 'iPhone' },
            "iPhone 15 Pro Max":{ w: 325, h: 670, r: '52px', b: '10px', type: 'island', category: 'iPhone', premium: true },
            "iPhone 16":        { w: 295, h: 615, r: '45px', b: '8px',  type: 'notch', category: 'iPhone' },
            "iPhone 16 Plus":   { w: 325, h: 675, r: '49px', b: '12px', type: 'notch', category: 'iPhone', premium: true },
            "iPhone 16 Pro":    { w: 298, h: 618, r: '48px', b: '7px',  type: 'island', category: 'iPhone' },
            "iPhone 16 Pro Max":{ w: 340, h: 700, r: '52px', b: '5px',  type: 'island', category: 'iPhone', premium: true },
            "iPhone 17":        { w: 297, h: 617, r: '45px', b: '8px',  type: 'notch', category: 'iPhone' },
            "iPhone 17 Pro":    { w: 300, h: 620, r: '48px', b: '7px',  type: 'island', category: 'iPhone' },
            "iPhone 17 Pro Max":{ w: 345, h: 710, r: '54px', b: '4px',  type: 'island', category: 'iPhone', premium: true },
            "iPhone Air":       { w: 310, h: 655, r: '47px', b: '10px', type: 'island', category: 'iPhone' },
            
            // Samsung
            "Samsung Galaxy S25":       { w: 283, h: 603, r: '44px', b: '10px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S25+":      { w: 303, h: 633, r: '46px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy S25 Ultra": { w: 322, h: 682, r: '48px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy S24":       { w: 280, h: 600, r: '44px', b: '10px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S24+":      { w: 300, h: 630, r: '46px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy S24 Ultra": { w: 320, h: 680, r: '48px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy S23":       { w: 278, h: 598, r: '44px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S23+":      { w: 298, h: 628, r: '46px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy S23 Ultra": { w: 318, h: 678, r: '48px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy S22":       { w: 275, h: 595, r: '43px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S22+":      { w: 295, h: 625, r: '45px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy S22 Ultra": { w: 315, h: 675, r: '48px', b: '12px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy A54":       { w: 270, h: 580, r: '40px', b: '8px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy A53":       { w: 268, h: 578, r: '40px', b: '8px', type: 'hole', category: 'Samsung', premium: true },
            "Samsung Galaxy A34":       { w: 265, h: 570, r: '38px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Z Fold 6":  { w: 310, h: 650, r: '32px', b: '10px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Z Flip 6":  { w: 165, h: 310, r: '20px', b: '6px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Note 20":   { w: 295, h: 630, r: '44px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy F15":       { w: 270, h: 575, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy F25":       { w: 278, h: 590, r: '42px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy f25 5G":    { w: 282, h: 595, r: '43px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M35":       { w: 275, h: 585, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M55":       { w: 288, h: 605, r: '42px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy C55":       { w: 285, h: 600, r: '41px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M15":       { w: 268, h: 575, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M25":       { w: 276, h: 588, r: '41px', b: '8px', type: 'hole', category: 'Samsung' }
        };

        const colors = [
            { name: 'Titanium', nameRu: '–¢–∏—Ç–∞–Ω', hex: '#373737' },
            { name: 'Silver', nameRu: '–°–µ—Ä–µ–±—Ä–æ', hex: '#e2e2e2' },
            { name: 'Gold', nameRu: '–ó–æ–ª–æ—Ç–æ', hex: '#f5e3c7' },
            { name: 'Midnight', nameRu: '–ü–æ–ª–Ω–æ—á—å', hex: '#1c1c1e' },
            { name: 'Deep Purple', nameRu: '–ì–ª—É–±–æ–∫–∏–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π', hex: '#4b3d54' },
            { name: 'Alpine Green', nameRu: '–ê–ª—å–ø–∏–π—Å–∫–∏–π –∑–µ–ª—ë–Ω—ã–π', hex: '#4f5d4e' },
            { name: 'Rose Pink', nameRu: '–†–æ–∑–æ–≤—ã–π', hex: '#e8a3b0' },
            { name: 'Ocean Blue', nameRu: '–ú–æ—Ä—Å–∫–æ–π —Å–∏–Ω–∏–π', hex: '#0066cc' },
            { name: 'Sunset Orange', nameRu: '–û—Ä–∞–Ω–∂–µ–≤—ã–π –∑–∞–∫–∞—Ç', hex: '#ff6b35' },
            { name: 'Forest Green', nameRu: '–õ–µ—Å–Ω–æ–π –∑–µ–ª—ë–Ω—ã–π', hex: '#2d5016' },
            { name: 'Burgundy', nameRu: '–ë–æ—Ä–¥–æ–≤—ã–π', hex: '#800020' },
            { name: 'Turquoise', nameRu: '–ë–∏—Ä—é–∑–æ–≤—ã–π', hex: '#40e0d0' },
            { name: 'Coral', nameRu: '–ö–æ—Ä–∞–ª–ª', hex: '#ff6f61' },
            { name: 'Cream', nameRu: '–ö—Ä–µ–º–æ–≤—ã–π', hex: '#fffdd0' },
            { name: 'Space Gray', nameRu: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Å–µ—Ä—ã–π', hex: '#2c3e50' }
        ];

        const positions = {
            "–†–æ–≤–Ω–æ": { transform: "rotateX(0deg) rotateY(0deg) rotateZ(0deg)", premium: false },
            "–í –ª–µ–≤–æ–π —Ä—É–∫–µ": { transform: "rotateX(5deg) rotateY(25deg) rotateZ(-5deg)", premium: false },
            "–í –ø—Ä–∞–≤–æ–π —Ä—É–∫–µ": { transform: "rotateX(5deg) rotateY(-25deg) rotateZ(5deg)", premium: false },
            "–°–º–æ—Ç—Ä–∏—Ç –≤–ª–µ–≤–æ": { transform: "rotateY(30deg)", premium: false },
            "–°–º–æ—Ç—Ä–∏—Ç –≤–ø—Ä–∞–≤–æ": { transform: "rotateY(-30deg)", premium: false },
            "–°–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö": { transform: "rotateX(30deg)", premium: false },
            "–°–º–æ—Ç—Ä–∏—Ç –≤–Ω–∏–∑": { transform: "rotateX(-30deg)", premium: false },
            "–ù–∞–∫–ª–æ–Ω": { transform: "rotateX(15deg) rotateY(15deg) rotateZ(5deg)", premium: true }
        };

        const frame = document.getElementById('device-frame');
        const screen = document.getElementById('screen');
        const notch = document.getElementById('notch');
        const screenBg = document.getElementById('screen-bg');
        const keyboard = document.getElementById('keyboard');

        let currentContentFile = null;

        // ====================== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ======================
        (function(){
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.innerHTML = `
                <div class="modal" role="dialog">
                    <div class="modal-title" id="modalTitle"></div>
                    <div class="modal-body" id="modalBody"></div>
                    <div class="modal-actions" id="modalActions"></div>
                </div>`;
            document.body.appendChild(overlay);

            window.createModal = function(title, message, buttons){
                return new Promise(resolve => {
                    const t = overlay.querySelector('#modalTitle');
                    const b = overlay.querySelector('#modalBody');
                    const actions = overlay.querySelector('#modalActions');
                    t.textContent = title || '';
                    b.textContent = message || '';
                    actions.innerHTML = '';
                    buttons.forEach(btn => {
                        const el = document.createElement('button');
                        el.className = 'btn' + (btn.primary? ' primary':'');
                        el.textContent = btn.label || 'OK';
                        el.onclick = () => {
                            overlay.style.display = 'none';
                            try{ if (btn.onClick) btn.onClick(); }catch(e){console.error(e)}
                            resolve(btn.value !== undefined ? btn.value : btn.label);
                        };
                        actions.appendChild(el);
                    });
                    overlay.style.display = 'flex';
                });
            };

            window.showMessage = function(text){ return createModal('', text, [{label:'–û–ö', value:'ok', primary:true}]); };
        })();

        // ====================== –ì–ï–ù–ï–†–ê–¶–ò–Ø –£–°–¢–†–û–ô–°–¢–í ======================
        const isPremium = localStorage.getItem('premium') === 'yes';
        let currentCategory = null;
        Object.keys(devices).forEach(name => {
            const device = devices[name];
            const category = device.category;
            const isDevicePremium = device.premium === true && !isPremium;
            
            let container = document.getElementById('deviceList');
            
            if (currentCategory !== category) {
                const header = document.createElement('div');
                header.className = "text-[9px] font-bold text-blue-300 mt-3 mb-2 px-2 uppercase tracking-widest";
                header.innerText = '‚îÅ‚îÅ ' + category + ' ‚îÅ‚îÅ';
                container.appendChild(header);
                currentCategory = category;
            }
            
            const btn = document.createElement('button');
            if (isDevicePremium) {
                btn.className = "w-full text-left px-3 py-1.5 rounded-lg text-[10px] text-slate-500 border border-slate-700/50 hover:border-slate-600 transition-all opacity-65 cursor-not-allowed flex items-center justify-between";
                btn.disabled = true;
                btn.innerHTML = `<span>${name}</span><span class="text-[8px] text-blue-400 font-bold flex items-center gap-1"><i class="fa-solid fa-lock" style="color: rgb(10, 98, 255);"></i>PREMIUM</span>`;
            } else {
                btn.className = "w-full text-left px-3 py-1.5 rounded-lg text-[10px] text-slate-300 border border-slate-800 hover:border-slate-600 transition-all";
                btn.innerText = name;
            }
            
            if (!isDevicePremium) {
                btn.onclick = () => {
                    document.querySelectorAll('#deviceList button').forEach(b => b.classList.remove('active-btn'));
                    btn.classList.add('active-btn');
                    const d = devices[name];
                    frame.style.width = d.w + 'px';
                    frame.style.height = d.h + 'px';
                    frame.style.borderRadius = d.r;
                    frame.style.borderWidth = d.b;
                    
                    keyboard.innerHTML = '';
                    
                    if (d.type === 'island') {
                        notch.style.width = '85px';
                        notch.style.height = '25px';
                        notch.style.top = '10px';
                        notch.style.borderRadius = '20px';
                        notch.style.display = '';
                        screen.style.height = '100%';
                        screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                        keyboard.style.display = 'none';
                    } else if (d.type === 'notch') {
                        notch.style.width = '110px';
                        notch.style.height = '28px';
                        notch.style.top = '0px';
                        notch.style.borderRadius = '0 0 15px 15px';
                        notch.style.display = '';
                        screen.style.height = '100%';
                        screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                        keyboard.style.display = 'none';
                    } else if (d.type === 'hole') {
                        notch.style.width = '20px';
                        notch.style.height = '20px';
                        notch.style.top = '12px';
                        notch.style.left = '50%';
                        notch.style.borderRadius = '50%';
                        notch.style.display = '';
                        screen.style.height = '100%';
                        screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                        keyboard.style.display = 'none';
                    }
                };
            }
            container.appendChild(btn);
        });
        
        const firstBtn = document.querySelector('#deviceList button');
        if (firstBtn) firstBtn.click();

        // ====================== –¶–í–ï–¢–ê ======================
        let midnightBtn = null;
        colors.forEach(c => {
            const btn = document.createElement('button');
            btn.className = "w-7 h-7 rounded-full border-2 border-slate-700 hover:scale-110 transition-transform relative group";
            btn.style.backgroundColor = c.hex;
            btn.title = c.nameRu || c.name;
            btn.onclick = () => {
                frame.style.borderColor = c.hex;
                document.querySelectorAll('#colorPalette button').forEach(b => b.classList.remove('ring-2', 'ring-blue-500'));
                btn.classList.add('ring-2', 'ring-blue-500');
            };
            if (c.name === 'Midnight') midnightBtn = btn;
            document.getElementById('colorPalette').appendChild(btn);
        });
        
        if (midnightBtn) {
            frame.style.borderColor = '#1c1c1e';
            midnightBtn.classList.add('ring-2', 'ring-blue-500');
        }

        const customColorContainer = document.createElement('div');
        customColorContainer.className = "flex items-center gap-1";
        const customColorPicker = document.createElement('input');
        customColorPicker.type = 'color';
        customColorPicker.id = 'customColorPicker';
        customColorPicker.className = "w-7 h-7 rounded-md border-2 border-slate-700 cursor-pointer hover:border-slate-500 transition-all";
        customColorPicker.style.padding = '2px';
        customColorPicker.value = '#3b82f6';
        customColorContainer.appendChild(customColorPicker);
        document.getElementById('colorPalette').appendChild(customColorContainer);
        
        const hexInput = document.createElement('input');
        hexInput.type = 'text';
        hexInput.placeholder = 'HEX';
        hexInput.className = "w-16 text-[9px] bg-slate-900/30 border border-slate-800 rounded-lg px-2 py-1 outline-none text-white placeholder-slate-500 uppercase font-mono";
        hexInput.maxLength = '7';
        hexInput.value = '#3b82f6';
        hexInput.style.marginLeft = 'auto';
        document.getElementById('colorPalette').appendChild(hexInput);

        customColorPicker.addEventListener('change', function(e) {
            const color = e.target.value.toUpperCase();
            frame.style.borderColor = color;
            hexInput.value = color;
            document.querySelectorAll('#colorPalette button').forEach(b => b.classList.remove('ring-2', 'ring-blue-500'));
        });
        customColorPicker.addEventListener('input', function(e) {
            const color = e.target.value.toUpperCase();
            frame.style.borderColor = color;
            hexInput.value = color;
        });
        hexInput.addEventListener('input', function(e) {
            let hex = e.target.value.toUpperCase();
            if (hex && !hex.startsWith('#')) hex = '#' + hex;
            if (/^#[0-9A-F]{6}$/.test(hex)) {
                frame.style.borderColor = hex;
                customColorPicker.value = hex;
            }
        });
        hexInput.addEventListener('blur', function(e) {
            if (!e.target.value.startsWith('#')) e.target.value = '#' + e.target.value;
        });

        // ====================== –ü–û–ó–ò–¶–ò–ò ======================
        const positionListEl = document.getElementById('positionList');
        const positionControl = document.createElement('div');
        positionControl.id = 'positionControl';
        positionControl.className = 'mt-2';
        positionControl.style.display = 'none';
        positionControl.innerHTML = `
            <div class="flex items-center gap-2">
                <label id="positionLabel" class="text-[10px] text-slate-300">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å</label>
                <input id="positionRange" type="range" min="0" max="200" value="100" step="1" class="flex-1">
                <span id="positionValue" class="text-[10px] text-slate-400">100%</span>
            </div>
        `;
        positionListEl.parentNode.insertBefore(positionControl, positionListEl.nextSibling);

        let currentBaseTransform = positions['–†–æ–≤–Ω–æ'].transform;
        function applyScaledTransform(baseTransform, percent) {
            const scale = percent / 100;
            const scaled = baseTransform.replace(/rotate([XYZ])\((-?\d+(?:\.\d+)?)deg\)/g, (m, axis, val) => {
                const num = parseFloat(val);
                const scaledNum = +(num * scale).toFixed(2);
                return `rotate${axis}(${scaledNum}deg)`;
            });
            frame.style.transform = scaled;
        }

        Object.keys(positions).forEach(pos => {
            const posData = positions[pos];
            const isPosPremium = posData.premium === true && !isPremium;
            const btn = document.createElement('button');
            
            if (isPosPremium) {
                btn.className = "px-2 py-1.5 rounded-lg text-[9px] bg-slate-800/30 border border-slate-700/50 transition-all opacity-60 cursor-not-allowed";
                btn.innerHTML = '<div class="text-[7px] text-blue-400 font-bold"><i class="fa-solid fa-lock" style="color: rgb(10, 98, 255);"></i> PREMIUM</div>' + pos;
                btn.disabled = true;
            } else {
                btn.className = "px-2 py-1.5 rounded-lg text-[9px] bg-slate-800/50 border border-slate-700 hover:bg-slate-700 transition-all";
                btn.innerText = pos;
                btn.onclick = () => {
                    document.querySelectorAll('#positionList button').forEach(b => b.classList.remove('active-btn'));
                    btn.classList.add('active-btn');
                    currentBaseTransform = posData.transform;
                    if (pos === '–†–æ–≤–Ω–æ') {
                        positionControl.style.display = 'none';
                        frame.style.transform = currentBaseTransform;
                    } else {
                        positionControl.style.display = '';
                        document.getElementById('positionRange').value = 100;
                        document.getElementById('positionValue').innerText = '100%';
                        applyScaledTransform(currentBaseTransform, 100);
                    }
                };
            }
            
            positionListEl.appendChild(btn);
            
            if(pos === "–†–æ–≤–Ω–æ") {
                btn.classList.add('active-btn');
                currentBaseTransform = posData.transform;
                positionControl.style.display = 'none';
                frame.style.transform = currentBaseTransform;
            }
        });

        const range = document.getElementById('positionRange');
        const valueLabel = document.getElementById('positionValue');
        range.addEventListener('input', function() {
            const v = parseInt(this.value, 10);
            valueLabel.innerText = v + '%';
            if (currentBaseTransform) applyScaledTransform(currentBaseTransform, v);
        });

        // ====================== DRAG & DROP ======================
        const dropZone = document.getElementById('dropZone');
        function handleDragOver(e) { e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drag-over'); }
        function handleDragLeave(e) { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over'); }

        const contentUpload = document.getElementById('contentUpload');
        const dropZoneText = document.getElementById('dropZoneText');
        const premiumMessage = document.getElementById('premiumMessage');
        
        contentUpload.accept = 'image/*';
        dropZoneText.textContent = '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ';
        premiumMessage.style.display = 'none';

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file) processFile(file);
        }

        function processFile(file) {
            if (file.type.startsWith('image/')) {
                currentContentFile = file;
                loadImage(file);
            } else {
                showMessage('–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            }
        }

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (ev) => screenBg.style.backgroundImage = `url('${ev.target.result}')`;
            reader.readAsDataURL(file);
        }



        // ====================== –ó–ê–ì–†–£–ó–ö–ê –ß–ï–†–ï–ó INPUT ======================
        contentUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) processFile(file);
        });

        // ====================== –û–¢–ü–†–ê–í–ö–ê ======================
        async function sendMockup() {
            const btn = document.getElementById('sendBtn');
            const origBtnHtml = btn.innerHTML;
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            btn.innerHTML = `<span class="animate-spin">üåÄ</span> –û—Ç–ø—Ä–∞–≤–∫–∞...`;

            try {
                const capture = document.getElementById('capture-area');
                const frameRect = frame.getBoundingClientRect();
                const origStyles = {
                    width: capture.style.width || '',
                    height: capture.style.height || '',
                    padding: capture.style.padding || '',
                    display: capture.style.display || '',
                    alignItems: capture.style.alignItems || '',
                    justifyContent: capture.style.justifyContent || ''
                };

                capture.style.display = 'flex';
                capture.style.alignItems = 'center';
                capture.style.justifyContent = 'center';
                capture.style.width = (Math.ceil(frameRect.width) + 80) + 'px';
                capture.style.height = (Math.ceil(frameRect.height) + 80) + 'px';
                capture.style.padding = '40px';

                const canvas = await html2canvas(capture, {
                    backgroundColor: '#0b0f19',
                    scale: 2,
                    useCORS: true
                });

                capture.style.width = origStyles.width;
                capture.style.height = origStyles.height;
                capture.style.padding = origStyles.padding;
                capture.style.display = origStyles.display;
                capture.style.alignItems = origStyles.alignItems;
                capture.style.justifyContent = origStyles.justifyContent;

                canvas.toBlob(async (blob) => {
                    try {
                        if (navigator.share) {
                            const file = new File([blob], 'mockup.png', { type: 'image/png' });
                            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                                await navigator.share({ files: [file], title: '–ú–æ–π –º–æ–∫–∞–ø' });
                            } else {
                                await navigator.share({ title: '–ú–æ–π –º–æ–∫–∞–ø', text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–æ–π –º–æ–∫–∞–ø!' });
                            }
                        } else {
                            showMessage('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                        }
                    } catch (e) {
                        console.error(e);
                    } finally {
                        btn.disabled = false;
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                        btn.innerHTML = origBtnHtml;
                    }
                }, 'image/png');
            } catch (e) {
                console.error(e);
                showMessage("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–∫–∞–ø–∞");
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.innerHTML = origBtnHtml;
            }
        }
    </script>
</body>
</html>