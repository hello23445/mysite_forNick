<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Studio Pro | 3D Perspective</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0b0f19; color: white; margin: 0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 3D */
        .perspective-container {
            perspective: 1200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #device-frame {
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), border-color 0.3s ease;
            transform-style: preserve-3d;
            border-style: solid;
        }

        .active-btn { 
            border-color: #3b82f6 !important; 
            background: rgba(59, 130, 246, 0.2) !important; 
            color: #fff !important;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        #screen-bg {
            width: 100%; height: 100%;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            transition: background-image 0.3s;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        @keyframes toast {
            0% { transform: translateY(100px); opacity: 0; }
            10% { transform: translateY(0); opacity: 1; }
            90% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(100px); opacity: 0; }
        }
        #toast { display: none; animation: toast 3s forwards; }

        /* Drag and Drop */
        .drag-over {
            border-color: #3b82f6 !important;
            background: rgba(59, 130, 246, 0.3) !important;
        }

        /* –°–∫—Ä–æ–ª –¥–ª—è —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        .device-scroll { max-height: 200px; overflow-y: auto; }

        /* –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤ */
        #keyboard { 
            display: none; 
            width: 100%; 
            height: 60px; 
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%); 
            border-radius: 0 0 inherit inherit; 
            position: absolute; 
            bottom: 0; 
            left: 0;
            padding: 8px;
            box-sizing: border-box;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            align-content: flex-start;
            overflow: hidden;
        }
        
        #keyboard::before {
            content: '';
            position: absolute;
            width: 90%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            top: 0;
            left: 5%;
        }
        
        .key {
            width: 8%; height: 18px; background: #333; border: 1px solid #222; border-radius: 2px; flex-shrink: 0;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] bg-green-500 text-white px-8 py-4 rounded-2xl shadow-2xl font-bold flex items-center gap-3">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        –ú–æ–∫–∞–ø –≥–æ—Ç–æ–≤!
    </div>

    <header class="py-4 border-b border-gray-800 bg-slate-900/50 backdrop-blur-md sticky top-0 z-50 px-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tighter">MOCKUP<span class="text-blue-500">GEN</span></h1>
            <span class="text-[10px] text-gray-500 font-mono border border-gray-800 px-2 py-1 rounded">PRO EDITION v3</span>
        </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-6 p-6">
        
        <div class="lg:col-span-4 space-y-3 pr-2">
            
            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">1. –ö–æ–Ω—Ç–µ–Ω—Ç —ç–∫—Ä–∞–Ω–∞</h3>
                <input type="file" id="imageUpload" class="hidden" accept="image/*" />
                <div id="dropZone" class="w-full py-3 border-2 border-dashed border-slate-700 rounded-xl text-xs text-slate-400 hover:border-blue-500 hover:text-blue-400 transition-all cursor-pointer text-center"
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('imageUpload').click()">
                    üìé –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ
                </div>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">2. –ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h3>
                <div class="device-scroll grid grid-cols-1 gap-1" id="deviceList"></div>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">3. –¶–≤–µ—Ç –∫–æ—Ä–ø—É—Å–∞</h3>
                <div class="flex flex-wrap gap-2 items-center" id="colorPalette"></div>
                <input type="color" id="customColorPicker" class="hidden" value="#3b82f6">
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">4. –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ</h3>
                <div class="grid grid-cols-2 gap-2" id="positionList"></div>
            </div>

            <button onclick="sendMockup()" id="sendBtn" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-2xl font-bold text-white shadow-xl shadow-blue-900/30 transition-all transform active:scale-95 flex items-center justify-center gap-3 flex-shrink-0">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                –ü–û–î–ï–õ–ò–¢–¨–°–Ø
            </button>
        </div>

        <div class="lg:col-span-8 glass rounded-[2.5rem] flex items-center justify-center relative bg-slate-950 overflow-auto p-4" style="min-height: calc(100vh - 120px);">
            <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: linear-gradient(#3b82f6 1px, transparent 1px), linear-gradient(90deg, #3b82f6 1px, transparent 1px); background-size: 40px 40px;"></div>
            
            <div id="capture-area" class="perspective-container py-12">
                <div id="device-frame" class="relative shadow-[0_50px_100px_-20px_rgba(0,0,0,1)]">
                    <div id="notch" class="absolute left-1/2 -translate-x-1/2 bg-black z-20"></div>
                    <div id="screen" class="absolute top-0 left-0 w-full overflow-hidden bg-black" style="height: 100%;">
                        <div id="screen-bg" style="background-image: url('https://images.unsplash.com/photo-1616348436168-de43ad0db179?q=80&w=1000');"></div>
                    </div>
                    <div class="absolute inset-0 pointer-events-none z-30 bg-gradient-to-tr from-white/5 via-transparent to-transparent rounded-[inherit]"></div>
                    <div id="keyboard"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const devices = {
            // iPhone
            "iPhone 11":        { w: 278, h: 580, r: '40px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 12":        { w: 280, h: 590, r: '40px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 12 Pro":    { w: 280, h: 590, r: '40px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 13":        { w: 290, h: 600, r: '42px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 13 Pro":    { w: 290, h: 600, r: '42px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 13 Pro Max":{ w: 320, h: 660, r: '46px', b: '12px', type: 'island', category: 'iPhone' },
            "iPhone 14":        { w: 292, h: 605, r: '43px', b: '9px',  type: 'notch', category: 'iPhone' },
            "iPhone 14 Plus":   { w: 320, h: 665, r: '48px', b: '12px', type: 'notch', category: 'iPhone' },
            "iPhone 14 Pro":    { w: 295, h: 610, r: '46px', b: '8px',  type: 'island', category: 'iPhone' },
            "iPhone 14 Pro Max":{ w: 325, h: 670, r: '50px', b: '12px', type: 'island', category: 'iPhone' },
            "iPhone 15":        { w: 293, h: 608, r: '44px', b: '8px',  type: 'notch', category: 'iPhone' },
            "iPhone 15 Plus":   { w: 322, h: 668, r: '48px', b: '12px', type: 'notch', category: 'iPhone' },
            "iPhone 15 Pro":    { w: 295, h: 610, r: '48px', b: '7px',  type: 'island', category: 'iPhone' },
            "iPhone 15 Pro Max":{ w: 325, h: 670, r: '52px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 16":        { w: 295, h: 615, r: '45px', b: '8px',  type: 'notch', category: 'iPhone' },
            "iPhone 16 Plus":   { w: 325, h: 675, r: '49px', b: '12px', type: 'notch', category: 'iPhone' },
            "iPhone 16 Pro":    { w: 298, h: 618, r: '48px', b: '7px',  type: 'island', category: 'iPhone' },
            "iPhone 16 Pro Max":{ w: 340, h: 700, r: '52px', b: '5px',  type: 'island', category: 'iPhone' },
            "iPhone 17 Pro Max":{ w: 345, h: 710, r: '54px', b: '4px',  type: 'island', category: 'iPhone' },
            
            // Samsung
            "Samsung Galaxy S24":       { w: 280, h: 600, r: '44px', b: '10px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S24+":      { w: 300, h: 630, r: '46px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S24 Ultra": { w: 320, h: 680, r: '48px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S23":       { w: 278, h: 598, r: '44px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S23+":      { w: 298, h: 628, r: '46px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S23 Ultra": { w: 318, h: 678, r: '48px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S22":       { w: 275, h: 595, r: '43px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S22+":      { w: 295, h: 625, r: '45px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S22 Ultra": { w: 315, h: 675, r: '48px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy A54":       { w: 270, h: 580, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy A53":       { w: 268, h: 578, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy A34":       { w: 265, h: 570, r: '38px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Z Fold 6":  { w: 310, h: 650, r: '32px', b: '10px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Z Flip 6":  { w: 165, h: 310, r: '20px', b: '6px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Note 20":   { w: 295, h: 630, r: '44px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy F15":       { w: 270, h: 575, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy F25":       { w: 278, h: 590, r: '42px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy f25 5G":    { w: 282, h: 595, r: '43px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M35":       { w: 275, h: 585, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M55":       { w: 288, h: 605, r: '42px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy C55":       { w: 285, h: 600, r: '41px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M15":       { w: 268, h: 575, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M25":       { w: 276, h: 588, r: '41px', b: '8px', type: 'hole', category: 'Samsung' }
        };

        const colors = [
            // –ë–∞–∑–æ–≤—ã–µ
            { name: 'Titanium', hex: '#373737' },
            { name: 'Silver', hex: '#e2e2e2' },
            { name: 'Gold', hex: '#f5e3c7' },
            { name: 'Midnight', hex: '#1c1c1e' },
            // –ù–æ–≤—ã–µ —Ü–≤–µ—Ç–∞
            { name: 'Deep Purple', hex: '#4b3d54' },
            { name: 'Alpine Green', hex: '#4f5d4e' },
            { name: 'Rose Pink', hex: '#e8a3b0' },
            { name: 'Ocean Blue', hex: '#0066cc' },
            { name: 'Sunset Orange', hex: '#ff6b35' },
            { name: 'Forest Green', hex: '#2d5016' },
            { name: 'Burgundy', hex: '#800020' },
            { name: 'Turquoise', hex: '#40e0d0' },
            { name: 'Coral', hex: '#ff6f61' },
            { name: 'Cream', hex: '#fffdd0' },
            { name: 'Space Gray', hex: '#2c3e50' }
        ];

        const positions = {
            "–†–æ–≤–Ω–æ": "rotateX(0deg) rotateY(0deg) rotateZ(0deg)",
            "–í –ª–µ–≤–æ–π —Ä—É–∫–µ": "rotateX(5deg) rotateY(25deg) rotateZ(-5deg)",
            "–í –ø—Ä–∞–≤–æ–π —Ä—É–∫–µ": "rotateX(5deg) rotateY(-25deg) rotateZ(5deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–ª–µ–≤–æ": "rotateY(30deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–ø—Ä–∞–≤–æ": "rotateY(-30deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö": "rotateX(30deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–Ω–∏–∑": "rotateX(-30deg)",
            "–ù–∞–∫–ª–æ–Ω": "rotateX(15deg) rotateY(15deg) rotateZ(5deg)"
        };

        const frame = document.getElementById('device-frame');
        const screen = document.getElementById('screen');
        const notch = document.getElementById('notch');
        const screenBg = document.getElementById('screen-bg');
        const keyboard = document.getElementById('keyboard');

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ú–æ–¥–µ–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        let currentCategory = null;
        Object.keys(devices).forEach(name => {
            const device = devices[name];
            const category = device.category;
            
            let container = document.getElementById('deviceList');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            if (currentCategory !== category) {
                const header = document.createElement('div');
                header.className = "text-[9px] font-bold text-blue-300 mt-3 mb-2 px-2 uppercase tracking-widest";
                header.innerText = '‚îÅ‚îÅ ' + category + ' ‚îÅ‚îÅ';
                container.appendChild(header);
                currentCategory = category;
            }
            
            const btn = document.createElement('button');
            btn.className = "w-full text-left px-3 py-1.5 rounded-lg text-[10px] text-slate-300 border border-slate-800 hover:border-slate-600 transition-all";
            btn.innerText = name;
            btn.onclick = () => {
                document.querySelectorAll('#deviceList button').forEach(b => b.classList.remove('active-btn'));
                btn.classList.add('active-btn');
                const d = devices[name];
                frame.style.width = d.w + 'px';
                frame.style.height = d.h + 'px';
                frame.style.borderRadius = d.r;
                frame.style.borderWidth = d.b;
                
                // –û—á–∏—â–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
                keyboard.innerHTML = '';
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ notch/hole –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                if (d.type === 'island') {
                    notch.style.width = '85px';
                    notch.style.height = '25px';
                    notch.style.top = '10px';
                    notch.style.borderRadius = '20px';
                    notch.style.display = '';
                    screen.style.height = '100%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                    keyboard.style.display = 'none';
                } else if (d.type === 'notch') {
                    notch.style.width = '110px';
                    notch.style.height = '28px';
                    notch.style.top = '0px';
                    notch.style.borderRadius = '0 0 15px 15px';
                    notch.style.display = '';
                    screen.style.height = '100%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                    keyboard.style.display = 'none';
                } else if (d.type === 'hole') {
                    notch.style.width = '20px';
                    notch.style.height = '20px';
                    notch.style.top = '12px';
                    notch.style.left = '50%';
                    notch.style.borderRadius = '50%';
                    notch.style.display = '';
                    screen.style.height = '100%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                    keyboard.style.display = 'none';
                } else if (d.type === 'laptop') {
                    notch.style.display = 'none';
                    // –î–ª—è –Ω–æ—É—Ç–±—É–∫–∞: —ç–∫—Ä–∞–Ω –∑–∞–Ω–∏–º–∞–µ—Ç 70% –≤—ã—Å–æ—Ç—ã, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ 30%
                    screen.style.height = '70%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b}) calc(${d.r} - ${d.b}) 0 0`;
                    keyboard.style.display = 'flex';
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª–∞–≤–∏—à–∏
                    for (let i = 0; i < 35; i++) {
                        const key = document.createElement('div');
                        key.className = 'key';
                        keyboard.appendChild(key);
                    }
                }
            };
            container.appendChild(btn);
        });
        
        // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π iPhone –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const firstBtn = document.querySelector('#deviceList button');
        if (firstBtn) firstBtn.click();

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¶–≤–µ—Ç–∞
        colors.forEach(c => {
            const btn = document.createElement('button');
            btn.className = "w-7 h-7 rounded-full border-2 border-slate-700 hover:scale-110 transition-transform relative group";
            btn.style.backgroundColor = c.hex;
            btn.title = c.name;
            btn.type = 'button';
            btn.onclick = () => {
                frame.style.borderColor = c.hex;
                document.querySelectorAll('#colorPalette button').forEach(b => b.classList.remove('ring-2', 'ring-blue-500'));
                btn.classList.add('ring-2', 'ring-blue-500');
            };
            document.getElementById('colorPalette').appendChild(btn);
        });

        // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–≤–æ–µ–≥–æ —Ü–≤–µ—Ç–∞
        const customColorContainer = document.createElement('div');
        customColorContainer.className = "flex items-center gap-2 border border-slate-800 rounded-lg px-3 py-1 bg-slate-900/30";
        
        const colorSquare = document.createElement('button');
        colorSquare.className = "w-7 h-7 rounded-md border-2 border-slate-700 cursor-pointer hover:border-slate-500 transition-all flex-shrink-0";
        colorSquare.style.backgroundColor = '#3b82f6';
        colorSquare.title = '–í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç';
        colorSquare.type = 'button';
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è color picker
        const openColorPicker = () => {
            const input = document.getElementById('customColorPicker');
            input.click();
        };
        
        colorSquare.addEventListener('click', openColorPicker);
        colorSquare.addEventListener('touchend', (e) => {
            e.preventDefault();
            openColorPicker();
        });
        
        const hexInput = document.createElement('input');
        hexInput.type = 'text';
        hexInput.placeholder = 'HEX';
        hexInput.className = "w-12 text-[9px] bg-transparent border-0 outline-none text-white placeholder-slate-500 uppercase font-mono";
        hexInput.maxLength = '7';
        hexInput.value = '#3b82f6';
        
        customColorContainer.appendChild(colorSquare);
        customColorContainer.appendChild(hexInput);
        document.getElementById('colorPalette').appendChild(customColorContainer);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è color picker
        document.getElementById('customColorPicker').addEventListener('change', function(e) {
            const color = e.target.value.toUpperCase();
            frame.style.borderColor = color;
            colorSquare.style.backgroundColor = color;
            hexInput.value = color;
            
            document.querySelectorAll('#colorPalette button').forEach(b => {
                b.classList.remove('ring-2', 'ring-blue-500');
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è HEX input
        hexInput.addEventListener('input', function(e) {
            let hex = e.target.value.toUpperCase();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º # –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (hex && !hex.startsWith('#')) {
                hex = '#' + hex;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å HEX –∫–æ–¥–∞
            if (/^#[0-9A-F]{6}$/.test(hex)) {
                frame.style.borderColor = hex;
                colorSquare.style.backgroundColor = hex;
                if (!e.target.value.startsWith('#')) {
                    e.target.value = hex;
                }
            }
        });
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å color picker
        hexInput.addEventListener('blur', function(e) {
            if (!e.target.value.startsWith('#')) {
                e.target.value = '#' + e.target.value;
            }
        });

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ü–æ–∑–∏—Ü–∏–∏
        Object.keys(positions).forEach(pos => {
            const btn = document.createElement('button');
            btn.className = "px-2 py-1.5 rounded-lg text-[9px] bg-slate-800/50 border border-slate-700 hover:bg-slate-700 transition-all";
            btn.innerText = pos;
            btn.onclick = () => {
                frame.style.transform = positions[pos];
                document.querySelectorAll('#positionList button').forEach(b => b.classList.remove('active-btn'));
                btn.classList.add('active-btn');
            };
            document.getElementById('positionList').appendChild(btn);
            if(pos === "–†–æ–≤–Ω–æ") btn.classList.add('active-btn');
        });

        // Drag and Drop –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        const dropZone = document.getElementById('dropZone');
        
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    loadImage(file);
                }
            }
        }
        
        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (ev) => screenBg.style.backgroundImage = `url('${ev.target.result}')`;
            reader.readAsDataURL(file);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ input
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                loadImage(file);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
        async function sendMockup() {
            const btn = document.getElementById('sendBtn');
            
            btn.disabled = true;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∏–ª—å –∏ –¥–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–π
            btn.dataset._origBg = btn.style.backgroundColor || '';
            btn.dataset._origCursor = btn.style.cursor || '';
            btn.classList.add('opacity-70');
            btn.style.backgroundColor = '#9ca3af';
            btn.style.cursor = 'not-allowed';
            btn.innerHTML = `<span class="animate-spin">üåÄ</span> –û—Ç–ø—Ä–∞–≤–∫–∞...`;

            try {
                // –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ—Ä–µ–∑ html2canvas
                const canvas = await html2canvas(document.getElementById('capture-area'), {
                    backgroundColor: '#0b0f19',
                    scale: 2,
                    useCORS: true
                });

                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ blob –¥–ª—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
                canvas.toBlob(async (blob) => {
                    try {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Share API
                        if (navigator.share) {
                            // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å —Ñ–∞–π–ª–æ–º
                            let shareSuccess = false;
                            
                            try {
                                const file = new File([blob], 'mockup.png', { type: 'image/png' });
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å –ø–æ–¥–µ–ª–µ–Ω —Ñ–∞–π–ª
                                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                                    await navigator.share({
                                        files: [file],
                                        title: '–ú–æ–π –º–æ–∫–∞–ø'
                                    });
                                    shareSuccess = true;
                                }
                            } catch (fileError) {
                                console.log('–§–∞–π–ª –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–µ–ª–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±');
                            }
                            
                            // –ï—Å–ª–∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∞–π–ª–æ–º –Ω–µ —É–¥–∞–ª–æ—Å—å, –¥–µ–ª–∏–º—Å—è –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–º
                            if (!shareSuccess) {
                                try {
                                    await navigator.share({
                                        title: '–ú–æ–π –º–æ–∫–∞–ø',
                                        text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–æ–π –º–æ–∫–∞–ø!'
                                    });
                                } catch (textError) {
                                    if (textError.name !== 'AbortError') {
                                        console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è:', textError);
                                    }
                                }
                            }
                        } else {
                            alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞:', e);
                    } finally {
                        btn.disabled = false;
                        btn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg> –ü–û–î–ï–õ–ò–¢–¨–°–Ø`;
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥
                        btn.style.backgroundColor = btn.dataset._origBg || '';
                        btn.style.cursor = btn.dataset._origCursor || '';
                        btn.classList.remove('opacity-70');
                        delete btn.dataset._origBg;
                        delete btn.dataset._origCursor;
                    }
                }, 'image/png');
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ:', e);
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–∫–∞–ø–∞");
                btn.disabled = false;
                btn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg> –ü–û–î–ï–õ–ò–¢–¨–°–Ø`;
            }
        }
    </script>
</body>
</html>
