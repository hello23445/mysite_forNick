<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Studio Pro | 3D Perspective</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0b0f19; color: white; margin: 0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 3D */
        .perspective-container {
            perspective: 1200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #device-frame {
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), border-color 0.3s ease;
            transform-style: preserve-3d;
            border-style: solid;
        }

        .active-btn { 
            border-color: #3b82f6 !important; 
            background: rgba(59, 130, 246, 0.2) !important; 
            color: #fff !important;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        #screen-bg {
            width: 100%; height: 100%;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            transition: background-image 0.3s;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        @keyframes toast {
            0% { transform: translateY(100px); opacity: 0; }
            10% { transform: translateY(0); opacity: 1; }
            90% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(100px); opacity: 0; }
        }
        #toast { display: none; animation: toast 3s forwards; }

        /* Drag and Drop */
        .drag-over {
            border-color: #3b82f6 !important;
            background: rgba(59, 130, 246, 0.3) !important;
        }

        /* –°–∫—Ä–æ–ª –¥–ª—è —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        .device-scroll { max-height: 200px; overflow-y: auto; }

        /* –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤ */
                try {
                            // –†–µ–Ω–¥–µ—Ä–∏–º –≥–æ—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—Ä–∞–º–∫–∞, –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ —Ç.–¥.)
                            let processedBlob;
                            try {
                                processedBlob = await renderVideoWithMockup(currentContentFile);
                            } catch (renderErr) {
                                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ –≤–∏–¥–µ–æ:', renderErr);
                                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏');
                                processedBlob = null;
                            }

                            if (!processedBlob) {
                                throw new Error('Processed video not available');
                            }

                            const processedFile = new File([processedBlob], 'mockup_video.webm', { type: processedBlob.type || 'video/webm' });

                            if (navigator.share) {
                                let shareSuccess = false;
                                try {
                                    if (navigator.canShare && navigator.canShare({ files: [processedFile] })) {
                                        await navigator.share({ files: [processedFile], title: '–ú–æ—ë –≤–∏–¥–µ–æ' });
                                        shareSuccess = true;
                                    }
                                } catch (fileError) {
                                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≥–æ—Ç–æ–≤—ã–º –≤–∏–¥–µ–æ-—Ñ–∞–π–ª–æ–º', fileError);
                                }

                                if (!shareSuccess) {
                                    try {
                                        await navigator.share({ title: '–ú–æ—ë –≤–∏–¥–µ–æ', text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–æ—ë –≤–∏–¥–µ–æ' });
                                    } catch (textError) {
                                        if (textError.name !== 'AbortError') console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è:', textError);
                                    }
                                }
                            } else {
                                alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                            }
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            top: 0;
            left: 5%;
        }
        
        .key {
            width: 8%; height: 18px; background: #333; border: 1px solid #222; border-radius: 2px; flex-shrink: 0;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] bg-green-500 text-white px-8 py-4 rounded-2xl shadow-2xl font-bold flex items-center gap-3">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        –ú–æ–∫–∞–ø –≥–æ—Ç–æ–≤!
    </div>

    <header class="py-4 border-b border-gray-800 bg-slate-900/50 backdrop-blur-md sticky top-0 z-50 px-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tighter">MOCKUP<span class="text-blue-500">GEN</span></h1>
            <span class="text-[10px] text-gray-500 font-mono border border-gray-800 px-2 py-1 rounded">PRO EDITION v3</span>
        </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-6 p-6">
        
        <div class="lg:col-span-4 space-y-3 pr-2">
            
            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">1. –ö–æ–Ω—Ç–µ–Ω—Ç —ç–∫—Ä–∞–Ω–∞</h3>
                <input type="file" id="contentUpload" class="hidden" />
                <div id="dropZone" class="w-full py-3 border-2 border-dashed border-slate-700 rounded-xl text-xs text-slate-400 hover:border-blue-500 hover:text-blue-400 transition-all cursor-pointer text-center"
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('contentUpload').click()">
                    üìé <span id="dropZoneText">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ</span>
                </div>
                <p id="premiumMessage" class="text-[8px] font-bold text-blue-400 mt-2 uppercase tracking-widest text-center" style="display:none;">
                    –ö—É–ø–∏—Ç–µ Premium, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–∏–¥–µ–æ
                </p>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">2. –ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h3>
                <div class="device-scroll grid grid-cols-1 gap-1" id="deviceList"></div>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">3. –¶–≤–µ—Ç –∫–æ—Ä–ø—É—Å–∞</h3>
                <div class="flex flex-wrap gap-2 items-center" id="colorPalette"></div>
            </div>

            <div class="glass p-5 rounded-2xl flex-shrink-0">
                <h3 class="text-[10px] font-bold text-blue-400 mb-3 uppercase tracking-widest">4. –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ</h3>
                <div class="grid grid-cols-2 gap-2" id="positionList"></div>
            </div>

            <button onclick="sendMockup()" id="sendBtn" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-2xl font-bold text-white shadow-xl shadow-blue-900/30 transition-all transform active:scale-95 flex items-center justify-center gap-3 flex-shrink-0">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                –ü–û–î–ï–õ–ò–¢–¨–°–Ø
            </button>
        </div>

        <div class="lg:col-span-8 glass rounded-[2.5rem] flex items-center justify-center relative bg-slate-950 overflow-auto p-4" style="min-height: calc(100vh - 120px);">
            <div class="absolute inset-0 opacity-20 pointer-events-none" style="background-image: linear-gradient(#3b82f6 1px, transparent 1px), linear-gradient(90deg, #3b82f6 1px, transparent 1px); background-size: 40px 40px;"></div>
            
            <div id="capture-area" class="perspective-container py-12">
                <div id="device-frame" class="relative shadow-[0_50px_100px_-20px_rgba(0,0,0,1)]">
                    <div id="notch" class="absolute left-1/2 -translate-x-1/2 bg-black z-20"></div>
                    <div id="screen" class="absolute top-0 left-0 w-full overflow-hidden bg-black" style="height: 100%;">
                        <div id="screen-bg" style="background-image: url('https://images.unsplash.com/photo-1616348436168-de43ad0db179?q=80&w=1000');"></div>
                    </div>
                    <div class="absolute inset-0 pointer-events-none z-30 bg-gradient-to-tr from-white/5 via-transparent to-transparent rounded-[inherit]"></div>
                    <div id="keyboard"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const devices = {
            // iPhone
            "iPhone 11":        { w: 278, h: 580, r: '40px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 12":        { w: 280, h: 590, r: '40px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 12 Pro":    { w: 280, h: 590, r: '40px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 13":        { w: 290, h: 600, r: '42px', b: '10px', type: 'notch', category: 'iPhone' },
            "iPhone 13 Pro":    { w: 290, h: 600, r: '42px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 13 Pro Max":{ w: 320, h: 660, r: '46px', b: '12px', type: 'island', category: 'iPhone' },
            "iPhone 14":        { w: 292, h: 605, r: '43px', b: '9px',  type: 'notch', category: 'iPhone' },
            "iPhone 14 Plus":   { w: 320, h: 665, r: '48px', b: '12px', type: 'notch', category: 'iPhone' },
            "iPhone 14 Pro":    { w: 295, h: 610, r: '46px', b: '8px',  type: 'island', category: 'iPhone' },
            "iPhone 14 Pro Max":{ w: 325, h: 670, r: '50px', b: '12px', type: 'island', category: 'iPhone' },
            "iPhone 15":        { w: 293, h: 608, r: '44px', b: '8px',  type: 'notch', category: 'iPhone' },
            "iPhone 15 Plus":   { w: 322, h: 668, r: '48px', b: '12px', type: 'notch', category: 'iPhone' },
            "iPhone 15 Pro":    { w: 295, h: 610, r: '48px', b: '7px',  type: 'island', category: 'iPhone' },
            "iPhone 15 Pro Max":{ w: 325, h: 670, r: '52px', b: '10px', type: 'island', category: 'iPhone' },
            "iPhone 16":        { w: 295, h: 615, r: '45px', b: '8px',  type: 'notch', category: 'iPhone' },
            "iPhone 16 Plus":   { w: 325, h: 675, r: '49px', b: '12px', type: 'notch', category: 'iPhone' },
            "iPhone 16 Pro":    { w: 298, h: 618, r: '48px', b: '7px',  type: 'island', category: 'iPhone' },
            "iPhone 16 Pro Max":{ w: 340, h: 700, r: '52px', b: '5px',  type: 'island', category: 'iPhone' },
            "iPhone 17 Pro Max":{ w: 345, h: 710, r: '54px', b: '4px',  type: 'island', category: 'iPhone' },
            
            // Samsung
            "Samsung Galaxy S24":       { w: 280, h: 600, r: '44px', b: '10px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S24+":      { w: 300, h: 630, r: '46px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S24 Ultra": { w: 320, h: 680, r: '48px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S23":       { w: 278, h: 598, r: '44px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S23+":      { w: 298, h: 628, r: '46px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S23 Ultra": { w: 318, h: 678, r: '48px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S22":       { w: 275, h: 595, r: '43px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S22+":      { w: 295, h: 625, r: '45px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy S22 Ultra": { w: 315, h: 675, r: '48px', b: '12px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy A54":       { w: 270, h: 580, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy A53":       { w: 268, h: 578, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy A34":       { w: 265, h: 570, r: '38px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Z Fold 6":  { w: 310, h: 650, r: '32px', b: '10px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Z Flip 6":  { w: 165, h: 310, r: '20px', b: '6px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy Note 20":   { w: 295, h: 630, r: '44px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy F15":       { w: 270, h: 575, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy F25":       { w: 278, h: 590, r: '42px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy f25 5G":    { w: 282, h: 595, r: '43px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M35":       { w: 275, h: 585, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M55":       { w: 288, h: 605, r: '42px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy C55":       { w: 285, h: 600, r: '41px', b: '9px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M15":       { w: 268, h: 575, r: '40px', b: '8px', type: 'hole', category: 'Samsung' },
            "Samsung Galaxy M25":       { w: 276, h: 588, r: '41px', b: '8px', type: 'hole', category: 'Samsung' }
        };

        const colors = [
            // –ë–∞–∑–æ–≤—ã–µ
            { name: 'Titanium', nameRu: '–¢–∏—Ç–∞–Ω', hex: '#373737' },
            { name: 'Silver', nameRu: '–°–µ—Ä–µ–±—Ä–æ', hex: '#e2e2e2' },
            { name: 'Gold', nameRu: '–ó–æ–ª–æ—Ç–æ', hex: '#f5e3c7' },
            { name: 'Midnight', nameRu: '–ü–æ–ª–Ω–æ—á—å', hex: '#1c1c1e' },
            // –ù–æ–≤—ã–µ —Ü–≤–µ—Ç–∞
            { name: 'Deep Purple', nameRu: '–ì–ª—É–±–æ–∫–∏–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π', hex: '#4b3d54' },
            { name: 'Alpine Green', nameRu: '–ê–ª—å–ø–∏–π—Å–∫–∏–π –∑–µ–ª—ë–Ω—ã–π', hex: '#4f5d4e' },
            { name: 'Rose Pink', nameRu: '–†–æ–∑–æ–≤—ã–π', hex: '#e8a3b0' },
            { name: 'Ocean Blue', nameRu: '–ú–æ—Ä—Å–∫–æ–π —Å–∏–Ω–∏–π', hex: '#0066cc' },
            { name: 'Sunset Orange', nameRu: '–û—Ä–∞–Ω–∂–µ–≤—ã–π –∑–∞–∫–∞—Ç', hex: '#ff6b35' },
            { name: 'Forest Green', nameRu: '–õ–µ—Å–Ω–æ–π –∑–µ–ª—ë–Ω—ã–π', hex: '#2d5016' },
            { name: 'Burgundy', nameRu: '–ë–æ—Ä–¥–æ–≤—ã–π', hex: '#800020' },
            { name: 'Turquoise', nameRu: '–ë–∏—Ä—é–∑–æ–≤—ã–π', hex: '#40e0d0' },
            { name: 'Coral', nameRu: '–ö–æ—Ä–∞–ª–ª', hex: '#ff6f61' },
            { name: 'Cream', nameRu: '–ö—Ä–µ–º–æ–≤—ã–π', hex: '#fffdd0' },
            { name: 'Space Gray', nameRu: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Å–µ—Ä—ã–π', hex: '#2c3e50' }
        ];

        const positions = {
            "–†–æ–≤–Ω–æ": "rotateX(0deg) rotateY(0deg) rotateZ(0deg)",
            "–í –ª–µ–≤–æ–π —Ä—É–∫–µ": "rotateX(5deg) rotateY(25deg) rotateZ(-5deg)",
            "–í –ø—Ä–∞–≤–æ–π —Ä—É–∫–µ": "rotateX(5deg) rotateY(-25deg) rotateZ(5deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–ª–µ–≤–æ": "rotateY(30deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–ø—Ä–∞–≤–æ": "rotateY(-30deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö": "rotateX(30deg)",
            "–°–º–æ—Ç—Ä–∏—Ç –≤–Ω–∏–∑": "rotateX(-30deg)",
            "–ù–∞–∫–ª–æ–Ω": "rotateX(15deg) rotateY(15deg) rotateZ(5deg)"
        };

        const frame = document.getElementById('device-frame');
        const screen = document.getElementById('screen');
        const notch = document.getElementById('notch');
        const screenBg = document.getElementById('screen-bg');
        const keyboard = document.getElementById('keyboard');
        // –¢–µ–∫—É—â–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        let currentContentFile = null; // File
        let currentContentType = null; // 'image' | 'video' | null
        let videoReady = false; // true –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ú–æ–¥–µ–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        let currentCategory = null;
        Object.keys(devices).forEach(name => {
            const device = devices[name];
            const category = device.category;
            
            let container = document.getElementById('deviceList');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            if (currentCategory !== category) {
                const header = document.createElement('div');
                header.className = "text-[9px] font-bold text-blue-300 mt-3 mb-2 px-2 uppercase tracking-widest";
                header.innerText = '‚îÅ‚îÅ ' + category + ' ‚îÅ‚îÅ';
                container.appendChild(header);
                currentCategory = category;
            }
            
            const btn = document.createElement('button');
            btn.className = "w-full text-left px-3 py-1.5 rounded-lg text-[10px] text-slate-300 border border-slate-800 hover:border-slate-600 transition-all";
            btn.innerText = name;
            btn.onclick = () => {
                document.querySelectorAll('#deviceList button').forEach(b => b.classList.remove('active-btn'));
                btn.classList.add('active-btn');
                const d = devices[name];
                frame.style.width = d.w + 'px';
                frame.style.height = d.h + 'px';
                frame.style.borderRadius = d.r;
                frame.style.borderWidth = d.b;
                
                // –û—á–∏—â–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
                keyboard.innerHTML = '';
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ notch/hole –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                if (d.type === 'island') {
                    notch.style.width = '85px';
                    notch.style.height = '25px';
                    notch.style.top = '10px';
                    notch.style.borderRadius = '20px';
                    notch.style.display = '';
                    screen.style.height = '100%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                    keyboard.style.display = 'none';
                } else if (d.type === 'notch') {
                    notch.style.width = '110px';
                    notch.style.height = '28px';
                    notch.style.top = '0px';
                    notch.style.borderRadius = '0 0 15px 15px';
                    notch.style.display = '';
                    screen.style.height = '100%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                    keyboard.style.display = 'none';
                } else if (d.type === 'hole') {
                    notch.style.width = '20px';
                    notch.style.height = '20px';
                    notch.style.top = '12px';
                    notch.style.left = '50%';
                    notch.style.borderRadius = '50%';
                    notch.style.display = '';
                    screen.style.height = '100%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b})`;
                    keyboard.style.display = 'none';
                } else if (d.type === 'laptop') {
                    notch.style.display = 'none';
                    // –î–ª—è –Ω–æ—É—Ç–±—É–∫–∞: —ç–∫—Ä–∞–Ω –∑–∞–Ω–∏–º–∞–µ—Ç 70% –≤—ã—Å–æ—Ç—ã, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ 30%
                    screen.style.height = '70%';
                    screen.style.borderRadius = `calc(${d.r} - ${d.b}) calc(${d.r} - ${d.b}) 0 0`;
                    keyboard.style.display = 'flex';
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª–∞–≤–∏—à–∏
                    for (let i = 0; i < 35; i++) {
                        const key = document.createElement('div');
                        key.className = 'key';
                        keyboard.appendChild(key);
                    }
                }
            };
            container.appendChild(btn);
        });
        
        // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π iPhone –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const firstBtn = document.querySelector('#deviceList button');
        if (firstBtn) firstBtn.click();

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¶–≤–µ—Ç–∞
        let midnightBtn = null;
        colors.forEach(c => {
            const btn = document.createElement('button');
            btn.className = "w-7 h-7 rounded-full border-2 border-slate-700 hover:scale-110 transition-transform relative group";
            btn.style.backgroundColor = c.hex;
            btn.title = c.nameRu || c.name;
            btn.type = 'button';
            btn.onclick = () => {
                frame.style.borderColor = c.hex;
                document.querySelectorAll('#colorPalette button').forEach(b => b.classList.remove('ring-2', 'ring-blue-500'));
                btn.classList.add('ring-2', 'ring-blue-500');
            };
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ Midnight –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (c.name === 'Midnight') {
                midnightBtn = btn;
            }
            document.getElementById('colorPalette').appendChild(btn);
        });
        
        // –í—ã–±–∏—Ä–∞–µ–º Midnight (—á–µ—Ä–Ω—ã–π) –∫–∞–∫ —Ü–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (midnightBtn) {
            frame.style.borderColor = '#1c1c1e';
            midnightBtn.classList.add('ring-2', 'ring-blue-500');
        }

        // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–≤–æ–µ–≥–æ —Ü–≤–µ—Ç–∞
        const customColorContainer = document.createElement('div');
        customColorContainer.className = "flex items-center gap-1";
        
        const customColorPicker = document.createElement('input');
        customColorPicker.type = 'color';
        customColorPicker.id = 'customColorPicker';
        customColorPicker.className = "w-7 h-7 rounded-md border-2 border-slate-700 cursor-pointer hover:border-slate-500 transition-all";
        customColorPicker.style.padding = '2px';
        customColorPicker.value = '#3b82f6';
        
        customColorContainer.appendChild(customColorPicker);
        document.getElementById('colorPalette').appendChild(customColorContainer);
        
        // HEX input —Å–ø—Ä–∞–≤–∞
        const hexInput = document.createElement('input');
        hexInput.type = 'text';
        hexInput.placeholder = 'HEX';
        hexInput.className = "w-16 text-[9px] bg-slate-900/30 border border-slate-800 rounded-lg px-2 py-1 outline-none text-white placeholder-slate-500 uppercase font-mono";
        hexInput.maxLength = '7';
        hexInput.value = '#3b82f6';
        hexInput.style.marginLeft = 'auto';
        document.getElementById('colorPalette').appendChild(hexInput);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è color picker
        customColorPicker.addEventListener('change', function(e) {
            const color = e.target.value.toUpperCase();
            frame.style.borderColor = color;
            hexInput.value = color;
            
            document.querySelectorAll('#colorPalette button').forEach(b => {
                b.classList.remove('ring-2', 'ring-blue-500');
            });
        });
        
        customColorPicker.addEventListener('input', function(e) {
            const color = e.target.value.toUpperCase();
            frame.style.borderColor = color;
            hexInput.value = color;
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è HEX input
        hexInput.addEventListener('input', function(e) {
            let hex = e.target.value.toUpperCase();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º # –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (hex && !hex.startsWith('#')) {
                hex = '#' + hex;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å HEX –∫–æ–¥–∞
            if (/^#[0-9A-F]{6}$/.test(hex)) {
                frame.style.borderColor = hex;
                customColorPicker.value = hex;
                if (!e.target.value.startsWith('#')) {
                    e.target.value = hex;
                }
            }
        });
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å color picker
        hexInput.addEventListener('blur', function(e) {
            if (!e.target.value.startsWith('#')) {
                e.target.value = '#' + e.target.value;
            }
        });

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ü–æ–∑–∏—Ü–∏–∏ + –∫–æ–Ω—Ç—Ä–æ–ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
        const positionListEl = document.getElementById('positionList');
        // –ö–æ–Ω—Ç—Ä–æ–ª –ø–æ–ª–∑—É–Ω–∫–∞ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–æ–∑–∏—Ü–∏–∏)
        const positionControl = document.createElement('div');
        positionControl.id = 'positionControl';
        positionControl.className = 'mt-2';
        positionControl.style.display = 'none';
        positionControl.innerHTML = `
            <div class="flex items-center gap-2">
                <label id="positionLabel" class="text-[10px] text-slate-300">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å</label>
                <input id="positionRange" type="range" min="0" max="200" value="100" step="1" class="flex-1">
                <span id="positionValue" class="text-[10px] text-slate-400">100%</span>
            </div>
        `;
        positionListEl.parentNode.insertBefore(positionControl, positionListEl.nextSibling);

        let currentBaseTransform = '';
        function applyScaledTransform(baseTransform, percent) {
            // scale numeric degree values inside rotateX/Y/Z(...) by percent/100
            const scale = percent / 100;
            const scaled = baseTransform.replace(/rotate([XYZ])\((-?\d+(?:\.\d+)?)deg\)/g, (m, axis, val) => {
                const num = parseFloat(val);
                const scaledNum = +(num * scale).toFixed(2);
                return `rotate${axis}(${scaledNum}deg)`;
            });
            frame.style.transform = scaled;
        }

        // –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ –ø–æ–∑–∏—Ü–∏–π
        Object.keys(positions).forEach(pos => {
            const btn = document.createElement('button');
            btn.className = "px-2 py-1.5 rounded-lg text-[9px] bg-slate-800/50 border border-slate-700 hover:bg-slate-700 transition-all";
            btn.innerText = pos;
            btn.onclick = () => {
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                document.querySelectorAll('#positionList button').forEach(b => b.classList.remove('active-btn'));
                btn.classList.add('active-btn');

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª
                currentBaseTransform = positions[pos];
                if (pos === '–†–æ–≤–Ω–æ') {
                    // –¥–ª—è —Ä–æ–≤–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª –∏ –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º transform
                    positionControl.style.display = 'none';
                    frame.style.transform = currentBaseTransform;
                } else {
                    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                    positionControl.style.display = '';
                    document.getElementById('positionRange').value = 100;
                    document.getElementById('positionValue').innerText = '100%';
                    applyScaledTransform(currentBaseTransform, 100);
                }
            };
            positionListEl.appendChild(btn);
            if(pos === "–†–æ–≤–Ω–æ") {
                btn.classList.add('active-btn');
                // –¥–ª—è –†–æ–≤–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é
                currentBaseTransform = positions[pos];
                positionControl.style.display = 'none';
                frame.style.transform = currentBaseTransform;
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–∑—É–Ω–∫–∞
        const range = document.getElementById('positionRange');
        const valueLabel = document.getElementById('positionValue');
        range.addEventListener('input', function() {
            const v = parseInt(this.value, 10);
            valueLabel.innerText = v + '%';
            if (currentBaseTransform) applyScaledTransform(currentBaseTransform, v);
        });

        // Drag and Drop –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        const dropZone = document.getElementById('dropZone');
        
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.add('drag-over');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ premium —Å—Ç–∞—Ç—É—Å–∞
        const isPremium = localStorage.getItem('premium') === 'yes';
        const contentUpload = document.getElementById('contentUpload');
        const dropZoneText = document.getElementById('dropZoneText');
        const premiumMessage = document.getElementById('premiumMessage');
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º accept –∞—Ç—Ä–∏–±—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç premium —Å—Ç–∞—Ç—É—Å–∞
        if (isPremium) {
            contentUpload.accept = 'image/*,video/*';
            dropZoneText.textContent = '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ (–¥–æ 20 —Å–µ–∫) –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ';
            premiumMessage.style.display = 'none';
        } else {
            contentUpload.accept = 'image/*';
            dropZoneText.textContent = '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ';
            premiumMessage.style.display = 'block';
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
                currentContentFile = file;
                if (file.type.startsWith('image/')) {
                    currentContentType = 'image';
                    videoReady = true;
                    loadImage(file);
                } else if (file.type.startsWith('video/') && isPremium) {
                    currentContentType = 'video';
                    videoReady = false;
                    loadVideo(file);
                }
            }
        }
        
        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (ev) => screenBg.style.backgroundImage = `url('${ev.target.result}')`;
            reader.readAsDataURL(file);
        }

        function loadVideo(file) {
            // file: File
            currentContentFile = file;
            currentContentType = 'video';
            videoReady = false;
            const video = document.createElement('video');
            video.preload = 'metadata';
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            video.onloadedmetadata = function() {
                if (video.duration > 20) {
                    alert('–í–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 20 —Å–µ–∫—É–Ω–¥. –í–∞—à–µ –≤–∏–¥–µ–æ: ' + Math.round(video.duration) + ' —Å–µ–∫—É–Ω–¥.');
                    currentContentFile = null;
                    currentContentType = null;
                    videoReady = false;
                    return;
                }
                // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –≤ dataURL –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–≤—å—é
                const reader = new FileReader();
                reader.onload = (ev) => {
                    screenBg.style.backgroundImage = 'none';
                    screen.innerHTML = `<video id="previewVideo" style="width:100%; height:100%; object-fit:cover;" src="${ev.target.result}" autoplay loop muted playsinline></video>`;
                    videoReady = true;
                };
                reader.readAsDataURL(file);
            };
            video.src = URL.createObjectURL(file);
        }

        // –†–µ–Ω–¥–µ—Ä–∏–º –≤–∏–¥–µ–æ –≤–º–µ—Å—Ç–µ —Å –º–∞–∫–µ—Ç–æ–º –≤ canvas –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º Blob –≤–∏–¥–µ–æ (webm)
        function renderVideoWithMockup(file) {
            return new Promise((resolve, reject) => {
                const frameRect = frame.getBoundingClientRect();
                const outW = Math.ceil(frameRect.width) + 80;
                const outH = Math.ceil(frameRect.height) + 80;

                const offCanvas = document.createElement('canvas');
                offCanvas.width = outW;
                offCanvas.height = outH;
                const ctx = offCanvas.getContext('2d');

                const vid = document.createElement('video');
                vid.muted = true;
                vid.playsInline = true;
                vid.src = URL.createObjectURL(file);
                vid.crossOrigin = 'anonymous';

                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∏–ª–∏ —Ä–∞–º–∫–∏
                const frameStyle = getComputedStyle(frame);
                const borderColor = frameStyle.borderColor || '#373737';
                const borderWidth = parseFloat(frameStyle.borderWidth) || 10;
                const radius = parseFloat(frameStyle.borderRadius) || 40;

                const innerX = 40 + borderWidth;
                const innerY = 40 + borderWidth;
                const innerW = outW - innerX * 2;
                const innerH = outH - innerY * 2;

                // –∑–∞–ø–∏—Å—å —Å canvas
                const stream = offCanvas.captureStream(30);
                let recorder;
                try {
                    recorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' });
                } catch (e) {
                    try { recorder = new MediaRecorder(stream); } catch (err) { reject(err); return; }
                }

                const chunks = [];
                recorder.ondataavailable = (ev) => { if (ev.data && ev.data.size) chunks.push(ev.data); };
                recorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'video/webm' });
                    resolve(blob);
                };

                // –†–∏—Å—É–µ–º –∫–∞–¥—Ä—ã –∏–∑ –≤–∏–¥–µ–æ –ø–æ requestAnimationFrame
                function drawFrame() {
                    // —Ñ–æ–Ω
                    ctx.fillStyle = '#0b0f19';
                    ctx.fillRect(0, 0, outW, outH);

                    // —Ä–∞–º–∫–∞ –∫–æ—Ä–ø—É—Å–∞
                    ctx.fillStyle = borderColor;
                    roundRect(ctx, 40, 40, outW - 80, outH - 80, radius);
                    ctx.fill();

                    // –∫–ª–∏–ø –≤–Ω—É—Ç—Ä—å —Å–∫—Ä—É–≥–ª—ë–Ω–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
                    ctx.save();
                    const clipR = Math.max(0, radius - borderWidth);
                    roundRect(ctx, innerX, innerY, innerW, innerH, clipR);
                    ctx.clip();

                    // –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä –≤–∏–¥–µ–æ –≤ –∑–æ–Ω–µ —ç–∫—Ä–∞–Ω–∞ —Å object-fit: cover
                    if (vid.videoWidth && vid.videoHeight) {
                        const vw = vid.videoWidth;
                        const vh = vid.videoHeight;
                        const scale = Math.max(innerW / vw, innerH / vh);
                        const dw = vw * scale;
                        const dh = vh * scale;
                        const dx = innerX - (dw - innerW) / 2;
                        const dy = innerY - (dh - innerH) / 2;
                        try { ctx.drawImage(vid, dx, dy, dw, dh); } catch(e) {}
                    }

                    ctx.restore();
                }

                // helper: —Ä–∏—Å—É–µ–º —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –ø—É—Ç—å
                function roundRect(ctx, x, y, w, h, r) {
                    const radius = Math.max(0, r);
                    ctx.beginPath();
                    ctx.moveTo(x + radius, y);
                    ctx.arcTo(x + w, y, x + w, y + h, radius);
                    ctx.arcTo(x + w, y + h, x, y + h, radius);
                    ctx.arcTo(x, y + h, x, y, radius);
                    ctx.arcTo(x, y, x + w, y, radius);
                    ctx.closePath();
                }

                let rafId = null;
                function loop() {
                    drawFrame();
                    rafId = requestAnimationFrame(loop);
                }

                vid.onplay = () => {
                    recorder.start();
                    loop();
                };

                vid.onended = () => {
                    // —Å—Ç–æ–ø —Ä–µ–Ω–¥–µ—Ä –∏ –∑–∞–ø–∏—Å—å
                    if (rafId) cancelAnimationFrame(rafId);
                    setTimeout(() => { try { recorder.stop(); } catch(e){} }, 100);
                };

                vid.onerror = (e) => { reject(e); };

                // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                vid.play().catch(err => { reject(err); });
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ input
        contentUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                currentContentFile = file;
                if (file.type.startsWith('image/')) {
                    currentContentType = 'image';
                    videoReady = true;
                    loadImage(file);
                } else if (file.type.startsWith('video/')) {
                    if (!isPremium) {
                        alert('–¢—Ä–µ–±—É–µ—Ç—Å—è Premium –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ');
                        return;
                    }
                    currentContentType = 'video';
                    videoReady = false;
                    loadVideo(file);
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
        async function sendMockup() {
            const btn = document.getElementById('sendBtn');

            // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç - –≤–∏–¥–µ–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è Premium)
            if (currentContentType === 'video') {
                if (!isPremium) { alert('–¢—Ä–µ–±—É–µ—Ç—Å—è Premium –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–∏–¥–µ–æ'); return; }
                if (!videoReady) { alert('–í–∏–¥–µ–æ –µ—â—ë –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è. –ü–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.'); return; }

                btn.disabled = true;
                btn.dataset._origBg = btn.style.backgroundColor || '';
                btn.dataset._origCursor = btn.style.cursor || '';
                btn.classList.add('opacity-70');
                btn.style.backgroundColor = '#9ca3af';
                btn.style.cursor = 'not-allowed';
                btn.innerHTML = `<span class="animate-spin">üåÄ</span> –û—Ç–ø—Ä–∞–≤–∫–∞...`;

                try {
                    if (navigator.share) {
                        let shareSuccess = false;
                        try {
                            const file = currentContentFile;
                            if (file && navigator.canShare && navigator.canShare({ files: [file] })) {
                                await navigator.share({ files: [file], title: '–ú–æ—ë –≤–∏–¥–µ–æ' });
                                shareSuccess = true;
                            }
                        } catch (fileError) {
                            console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≤–∏–¥–µ–æ-—Ñ–∞–π–ª–æ–º', fileError);
                        }

                        if (!shareSuccess) {
                            try {
                                await navigator.share({ title: '–ú–æ—ë –≤–∏–¥–µ–æ', text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–æ—ë –≤–∏–¥–µ–æ' });
                            } catch (textError) {
                                if (textError.name !== 'AbortError') console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è:', textError);
                            }
                        }
                    } else {
                        alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤–∏–¥–µ–æ:', e);
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg> –ü–û–î–ï–õ–ò–¢–¨–°–Ø`;
                    btn.style.backgroundColor = btn.dataset._origBg || '';
                    btn.style.cursor = btn.dataset._origCursor || '';
                    btn.classList.remove('opacity-70');
                    delete btn.dataset._origBg;
                    delete btn.dataset._origCursor;
                }

                return;
            }

            btn.disabled = true;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∏–ª—å –∏ –¥–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–π
            btn.dataset._origBg = btn.style.backgroundColor || '';
            btn.dataset._origCursor = btn.style.cursor || '';
            btn.classList.add('opacity-70');
            btn.style.backgroundColor = '#9ca3af';
            btn.style.cursor = 'not-allowed';
            btn.innerHTML = `<span class="animate-spin">üåÄ</span> –û—Ç–ø—Ä–∞–≤–∫–∞...`;

            try {
                // –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞—Å—à–∏—Ä–∏–º –æ–±–ª–∞—Å—Ç—å –∑–∞—Ö–≤–∞—Ç–∞
                const capture = document.getElementById('capture-area');
                const frameRect = frame.getBoundingClientRect();
                // –°–æ—Ö—Ä–∞–Ω–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                const origStyles = {
                    width: capture.style.width || '',
                    height: capture.style.height || '',
                    padding: capture.style.padding || '',
                    display: capture.style.display || '',
                    alignItems: capture.style.alignItems || '',
                    justifyContent: capture.style.justifyContent || ''
                };
                // –£—Å—Ç–∞–Ω–æ–≤–∏–º —Ä–∞–∑–º–µ—Ä—ã, —á—Ç–æ–±—ã –≤–æ–∫—Ä—É–≥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –±—ã–ª –æ—Ç—Å—Ç—É–ø 40px
                capture.style.display = 'flex';
                capture.style.alignItems = 'center';
                capture.style.justifyContent = 'center';
                capture.style.width = (Math.ceil(frameRect.width) + 80) + 'px';
                capture.style.height = (Math.ceil(frameRect.height) + 80) + 'px';
                capture.style.padding = '40px';

                // –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ—Ä–µ–∑ html2canvas
                const canvas = await html2canvas(capture, {
                    backgroundColor: '#0b0f19',
                    scale: 2,
                    useCORS: true
                });

                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ (–¥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ blob –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è)
                capture.style.width = origStyles.width;
                capture.style.height = origStyles.height;
                capture.style.padding = origStyles.padding;
                capture.style.display = origStyles.display;
                capture.style.alignItems = origStyles.alignItems;
                capture.style.justifyContent = origStyles.justifyContent;

                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ blob –¥–ª—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
                canvas.toBlob(async (blob) => {
                    try {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Share API
                        if (navigator.share) {
                            // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å —Ñ–∞–π–ª–æ–º
                            let shareSuccess = false;
                            
                            try {
                                const file = new File([blob], 'mockup.png', { type: 'image/png' });
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å –ø–æ–¥–µ–ª–µ–Ω —Ñ–∞–π–ª
                                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                                    await navigator.share({
                                        files: [file],
                                        title: '–ú–æ–π –º–æ–∫–∞–ø'
                                    });
                                    shareSuccess = true;
                                }
                            } catch (fileError) {
                                console.log('–§–∞–π–ª –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–µ–ª–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±');
                            }
                            
                            // –ï—Å–ª–∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∞–π–ª–æ–º –Ω–µ —É–¥–∞–ª–æ—Å—å, –¥–µ–ª–∏–º—Å—è –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–º
                            if (!shareSuccess) {
                                try {
                                    await navigator.share({
                                        title: '–ú–æ–π –º–æ–∫–∞–ø',
                                        text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–æ–π –º–æ–∫–∞–ø!'
                                    });
                                } catch (textError) {
                                    if (textError.name !== 'AbortError') {
                                        console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è:', textError);
                                    }
                                }
                            }
                        } else {
                            alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞:', e);
                    } finally {
                        btn.disabled = false;
                        btn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg> –ü–û–î–ï–õ–ò–¢–¨–°–Ø`;
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥
                        btn.style.backgroundColor = btn.dataset._origBg || '';
                        btn.style.cursor = btn.dataset._origCursor || '';
                        btn.classList.remove('opacity-70');
                        delete btn.dataset._origBg;
                        delete btn.dataset._origCursor;
                    }
                }, 'image/png');
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ:', e);
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–∫–∞–ø–∞");
                btn.disabled = false;
                btn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg> –ü–û–î–ï–õ–ò–¢–¨–°–Ø`;
            }
        }
    </script>
</body>
</html>